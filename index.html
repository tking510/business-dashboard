<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº‹æ¥­åˆ¥ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f1f5f9; min-height: 100vh; }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; flex-wrap: wrap; gap: 16px; }
    .header h1 { font-size: 24px; color: #1e293b; display: flex; align-items: center; gap: 10px; }
    .header-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .card { background: white; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); padding: 20px; margin-bottom: 20px; }
    .tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
    .tab { padding: 10px 18px; border-radius: 10px; border: none; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s; background: #e2e8f0; color: #475569; }
    .tab:hover { background: #cbd5e1; }
    .tab.active { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
    .btn { padding: 10px 20px; border-radius: 10px; border: none; cursor: pointer; font-weight: 600; transition: all 0.2s; display: inline-flex; align-items: center; gap: 6px; }
    .btn-primary { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
    .btn-secondary { background: #f1f5f9; color: #475569; }
    .btn-danger { background: #fee2e2; color: #dc2626; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .summary-card { border-radius: 14px; padding: 16px; color: white; }
    .summary-card h3 { font-size: 12px; opacity: 0.9; margin-bottom: 4px; }
    .summary-card .value { font-size: 22px; font-weight: 700; }
    .summary-card .sub { font-size: 11px; opacity: 0.8; margin-top: 4px; }
    .chart-container { height: 300px; margin: 20px 0; }
    .period-selector { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
    .period-btn { padding: 6px 14px; border-radius: 8px; border: none; cursor: pointer; font-size: 12px; background: #f1f5f9; color: #64748b; }
    .period-btn.active { background: #3b82f6; color: white; }
    .upload-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
    .upload-content { background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; }
    .upload-zone { border: 2px dashed #cbd5e1; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.2s; }
    .upload-zone:hover, .upload-zone.dragover { border-color: #3b82f6; background: #eff6ff; }
    .hidden { display: none !important; }
    .links-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; max-height: 400px; overflow-y: auto; }
    .link-category { background: white; border-radius: 12px; padding: 16px; border: 1px solid #e2e8f0; }
    .link-category h4 { font-size: 13px; color: #64748b; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #e2e8f0; }
    .link-item { display: inline-block; background: #dbeafe; color: #1d4ed8; padding: 4px 10px; border-radius: 6px; font-size: 12px; margin: 3px; text-decoration: none; transition: all 0.2s; }
    .link-item:hover { background: #bfdbfe; transform: translateY(-1px); }
    .table-container { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { padding: 10px 12px; text-align: left; border-bottom: 1px solid #e2e8f0; }
    th { background: #f8fafc; font-weight: 600; color: #64748b; }
    tr:hover { background: #f8fafc; }
    .text-right { text-align: right; }
    .text-green { color: #16a34a; }
    .text-red { color: #dc2626; }
    input[type="text"], input[type="file"], select { padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; width: 100%; }
    input:focus, select:focus { outline: none; border-color: #3b82f6; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; font-size: 13px; color: #64748b; margin-bottom: 6px; }
    .empty-state { text-align: center; padding: 60px 20px; color: #94a3b8; }
    .empty-state svg { width: 60px; height: 60px; margin-bottom: 16px; opacity: 0.5; }
    footer { text-align: center; color: #94a3b8; font-size: 11px; margin-top: 30px; padding: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“Š äº‹æ¥­åˆ¥ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
      <div class="header-actions">
        <button class="btn btn-primary" onclick="showUploadModal()">ğŸ“¤ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</button>
        <button class="btn btn-secondary" onclick="addBusiness()">â• äº‹æ¥­è¿½åŠ </button>
      </div>
    </div>

    <div class="tabs" id="business-tabs"></div>

    <div id="period-selector" class="period-selector"></div>

    <div id="summary-section" class="summary-grid"></div>

    <div class="card">
      <h3 style="margin-bottom: 16px; color: #1e293b;">ğŸ“ˆ æœˆåˆ¥æ¨ç§»</h3>
      <div class="chart-container">
        <canvas id="main-chart"></canvas>
      </div>
    </div>

    <div id="links-section" class="card hidden">
      <h3 style="margin-bottom: 16px; color: #1e293b;">ğŸ”— ãƒªãƒ³ã‚¯ä¸€è¦§</h3>
      <div id="links-grid" class="links-grid"></div>
    </div>

    <div id="data-table" class="card">
      <h3 style="margin-bottom: 16px; color: #1e293b;">ğŸ“‹ è©³ç´°ãƒ‡ãƒ¼ã‚¿</h3>
      <div class="table-container">
        <table id="detail-table">
          <thead><tr id="table-header"></tr></thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>
    </div>

    <footer>åç›Šç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | å…ƒamuseãƒ»DSCãƒ»ã‚¹ãƒ­å¤©å¯¾å¿œ</footer>
  </div>

  <!-- Upload Modal -->
  <div id="upload-modal" class="upload-modal hidden">
    <div class="upload-content">
      <h3 style="margin-bottom: 20px;">ğŸ“¤ ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h3>
      <div class="form-group">
        <label>æœŸé–“ï¼ˆä¾‹: 2025å¹´10æœˆï¼‰</label>
        <input type="text" id="upload-period" placeholder="2025å¹´10æœˆ">
      </div>
      <div class="upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()">
        <div style="font-size: 40px; margin-bottom: 10px;">ğŸ“</div>
        <p>ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</p>
        <p style="font-size: 12px; color: #94a3b8; margin-top: 8px;">.xlsx, .xls, .csv å¯¾å¿œ</p>
      </div>
      <input type="file" id="file-input" accept=".xlsx,.xls,.csv" style="display:none" onchange="handleFileUpload(this.files[0])">
      <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
        <button class="btn btn-secondary" onclick="hideUploadModal()">é–‰ã˜ã‚‹</button>
      </div>
    </div>
  </div>

  <script>
// ===== ãƒ‡ãƒ¼ã‚¿å®šç¾© =====
const BUSINESSES_DATA = {
  'å…ƒamuse': {
    '2025å¹´10æœˆ': { 'GGR': 70311340, 'NGR': 30910896, 'T/O': 1577495817, 'RTP': 95.54, 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°': 294, 'FTDæ•°': 48, 'å›åç‡': 77.89, 'LTV': 239154 },
    '2025å¹´9æœˆ': { 'GGR': -2176638, 'NGR': 0, 'T/O': 56770645, 'RTP': 103.83, 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°': 0, 'FTDæ•°': 0, 'å›åç‡': 0, 'LTV': 0 },
    '2025å¹´8æœˆ': { 'GGR': 56952667, 'NGR': 23459499, 'T/O': 1910465086, 'RTP': 97.35, 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°': 284, 'FTDæ•°': 12, 'å›åç‡': 77.59, 'LTV': 92276 },
    '2025å¹´7æœˆ': { 'GGR': 89408914, 'NGR': 3791600, 'T/O': 3753649644, 'RTP': 97.62, 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°': 381, 'FTDæ•°': 11, 'å›åç‡': 66.86, 'LTV': 34271 },
    '2025å¹´6æœˆ': { 'GGR': 106821992, 'NGR': 69120861, 'T/O': 3764837698, 'RTP': 97.16, 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°': 698, 'FTDæ•°': 0, 'å›åç‡': 0, 'LTV': 113348 },
    '2025å¹´5æœˆ': { 'GGR': 30822400, 'NGR': 21494893, 'T/O': 5416323482, 'RTP': 99.95, 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°': 754, 'FTDæ•°': 110, 'å›åç‡': 83.35, 'LTV': 40878 },
  },
  'DSC': {
    '2026å¹´1æœˆ': { 'GGR': 43248155, 'NGR': 20776887, 'T/O': 1342354453, 'RTP': 96.78, 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°': 173, 'FTDæ•°': 10, 'å›åç‡': 80.07, 'LTV': 128277 },
    '2025å¹´12æœˆ': { 'GGR': 53578505, 'NGR': 31242527, 'T/O': 1514244472, 'RTP': 96.46, 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°': 292, 'FTDæ•°': 1, 'å›åç‡': 83.81, 'LTV': 133161 },
    '2025å¹´11æœˆ': { 'GGR': 64900999, 'NGR': 33610642, 'T/O': 1568206349, 'RTP': 95.86, 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°': 227, 'FTDæ•°': 29, 'å›åç‡': 82.91, 'LTV': 191404 },
    '2025å¹´9æœˆ': { 'GGR': 74174997, 'NGR': 31772784, 'T/O': 2578173994, 'RTP': 97.12, 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°': 298, 'FTDæ•°': 73, 'å›åç‡': 81.94, 'LTV': 137774 },
  },
  'ã‚¹ãƒ­å¤©': {}
};

// DSCãƒªãƒ³ã‚¯
const DSC_LINKS = [
  { category: 'WELCOMELP', name: 'ãƒ¡ã‚¤ãƒ³', url: 'https://lp.diamond-secret.club/' },
  { category: 'WELCOMELP', name: '1', url: 'https://lp.diamond-secret.club/1/' },
  { category: 'WELCOMELP', name: 'A', url: 'https://lp.diamond-secret.club/A/' },
  { category: 'WELCOMELP', name: 'BIZ', url: 'https://lp.diamond-secret.club/BIZ/' },
  { category: 'WELCOMELP', name: 'AR', url: 'https://lp.diamond-secret.club/AR/' },
  { category: 'é–‹é‹LP', name: 'ãƒ¡ã‚¤ãƒ³', url: 'https://lp.diamond-secret.club/kaiun/' },
  { category: 'é–‹é‹LP', name: 'AR', url: 'https://lp.diamond-secret.club/kaiun/AR/' },
  { category: 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³LP', name: 'ãƒã‚«ãƒ©å¤§ä¼š', url: 'https://lp.diamond-secret.club/baccaratournament/' },
  { category: 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³LP', name: 'å‹ã¡ãƒãƒƒã‚¯', url: 'https://lp.diamond-secret.club/backlp/' },
  { category: 'ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³LP', name: 'å®ãã˜', url: 'https://lp.diamond-secret.club/takarakuji/' },
  { category: 'ãƒ„ãƒ¼ãƒ«', name: 'MOL', url: 'https://mol-d-x.com/' },
  { category: 'ãƒ„ãƒ¼ãƒ«', name: 'MOLç®¡ç†ç”»é¢', url: 'https://mol-d-x.com/admin' },
  { category: 'ãƒ„ãƒ¼ãƒ«', name: 'æš´éœ²ãƒšãƒ¼ã‚¸', url: 'https://expose.diamond-secret.club/' },
  { category: 'ãƒ„ãƒ¼ãƒ«', name: 'å…¥å‡ºé‡‘ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ', url: 'https://payment.diamond-secret.club/' },
];

// ã‚¹ãƒ­å¤©ãƒªãƒ³ã‚¯ï¼ˆ162ä»¶ã‹ã‚‰æŠœç²‹ï¼‰
const SLOTEN_LINKS = [
  { category: 'å…¨éƒ¨ç½²', name: 'ç®¡ç†ç”»é¢BO', url: 'https://admin.sloten.io/' },
  { category: 'å…¨éƒ¨ç½²', name: 'ã‚·ãƒ•ãƒˆ', url: 'https://docs.google.com/spreadsheets/d/1tR0hRKy7wyKMc9Nk1MhQ_kOqs3Acg6LoG-nau1VETIA/edit' },
  { category: 'å…¨éƒ¨ç½²', name: 'å…¬å¼ã‚µã‚¤ãƒˆ', url: 'https://sloten.io/' },
  { category: 'å…¨éƒ¨ç½²', name: 'DISCORD', url: 'https://discord.gg/7hrDaJfw' },
  { category: 'å…¨éƒ¨ç½²', name: 'LINE', url: 'https://lin.ee/jTDURj3' },
  { category: 'å…¨éƒ¨ç½²', name: 'TELEGRAM', url: 'https://t.me/slotheavenbot' },
  { category: 'AFF', name: 'AFFéƒ¨é–€', url: 'https://docs.google.com/spreadsheets/d/1GLaqQEoqEJZSRUUkYHiPKMhPXG7X7gwRmpoCe14FTQ8/edit' },
  { category: 'AFF', name: 'ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆç®¡ç†ç”»é¢', url: 'https://asp.sloten.io/login?redirect=/home' },
  { category: 'CS', name: 'CSéƒ¨é–€', url: 'https://docs.google.com/spreadsheets/d/1lmjDjjwtQvykisZAqUD2OsI9zB_Xru8nTkGIPo5NSsY/edit' },
  { category: 'CS', name: 'ãƒãƒ£ãƒƒãƒˆã‚¦ãƒƒãƒ‰', url: 'https://im.slot-h.com/app/accounts/3/dashboard' },
  { category: 'ã‚ªãƒš', name: 'KPI', url: 'https://docs.google.com/spreadsheets/d/1oGnetFNtGd1ZB-A9YkzzfqIU4Bxh3djsABeEX_bHl8M/edit' },
  { category: 'ã‚ªãƒš', name: 'ãƒ¡ãƒ¼ãƒ©ãƒ¼', url: 'https://fviainboxes.com/' },
  { category: 'ãƒšã‚¤ãƒ¡ãƒ³ãƒˆ', name: 'ãƒã‚¤ãƒ³ãƒˆBO', url: 'https://add.sloten.io/' },
  { category: 'admin', name: 'ã‚¹ãƒ­å¤©ã‚¬ãƒãƒ£', url: 'https://lp.diamond-secret.club/Slotengacha/' },
  { category: 'admin', name: 'ã‚¹ãƒ­å¤©ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ', url: 'https://lp.diamond-secret.club/Slotenroulet/' },
  { category: 'ãƒ„ãƒ¼ãƒ«', name: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', url: 'https://sloten-dashboard.manus.space/' },
  { category: 'ãƒ„ãƒ¼ãƒ«', name: 'ãƒªãƒ³ã‚¯é›†', url: 'https://sloten-link.manus.space' },
  { category: 'ãƒ„ãƒ¼ãƒ«', name: 'CSVã‚»ã‚°ãƒ¡ãƒ³ãƒˆ', url: 'https://crm-segmentation-tool-gnwlkpueqvcdgapck3uv8z.streamlit.app/' },
  { category: 'ãã®ä»–', name: 'CLOUD', url: 'https://panel.cloudzy.com/dashboard' },
  { category: 'ãã®ä»–', name: 'DC/ACE', url: 'https://share.dc-ace.com/login' },
];

// ===== çŠ¶æ…‹ç®¡ç† =====
let currentBusiness = 'å…ƒamuse';
let currentPeriod = null;
let chartInstance = null;

// ===== åˆæœŸåŒ– =====
document.addEventListener('DOMContentLoaded', () => {
  renderTabs();
  selectBusiness('å…ƒamuse');
  setupDragDrop();
});

// ===== ã‚¿ãƒ–æç”» =====
function renderTabs() {
  const container = document.getElementById('business-tabs');
  container.innerHTML = Object.keys(BUSINESSES_DATA).map(name => 
    `<button class="tab ${name === currentBusiness ? 'active' : ''}" onclick="selectBusiness('${name}')">${name}</button>`
  ).join('') + `<button class="tab btn-danger" onclick="deleteBusiness()" style="margin-left: auto;">ğŸ—‘ï¸ å‰Šé™¤</button>`;
}

// ===== äº‹æ¥­é¸æŠ =====
function selectBusiness(name) {
  currentBusiness = name;
  const data = BUSINESSES_DATA[name] || {};
  const periods = Object.keys(data).sort((a, b) => {
    const [yA, mA] = a.match(/(\d+)å¹´(\d+)æœˆ/).slice(1).map(Number);
    const [yB, mB] = b.match(/(\d+)å¹´(\d+)æœˆ/).slice(1).map(Number);
    return (yB * 12 + mB) - (yA * 12 + mA);
  });
  
  currentPeriod = periods[0] || null;
  
  renderTabs();
  renderPeriodSelector(periods);
  renderSummary();
  renderChart();
  renderLinks();
  renderTable();
}

// ===== æœŸé–“ã‚»ãƒ¬ã‚¯ã‚¿ =====
function renderPeriodSelector(periods) {
  const container = document.getElementById('period-selector');
  if (periods.length === 0) {
    container.innerHTML = '';
    return;
  }
  container.innerHTML = periods.map(p => 
    `<button class="period-btn ${p === currentPeriod ? 'active' : ''}" onclick="selectPeriod('${p}')">${p}</button>`
  ).join('');
}

function selectPeriod(period) {
  currentPeriod = period;
  renderPeriodSelector(Object.keys(BUSINESSES_DATA[currentBusiness] || {}).sort((a, b) => {
    const [yA, mA] = a.match(/(\d+)å¹´(\d+)æœˆ/).slice(1).map(Number);
    const [yB, mB] = b.match(/(\d+)å¹´(\d+)æœˆ/).slice(1).map(Number);
    return (yB * 12 + mB) - (yA * 12 + mA);
  }));
  renderSummary();
  renderTable();
}

// ===== ã‚µãƒãƒªãƒ¼ã‚«ãƒ¼ãƒ‰ =====
function renderSummary() {
  const container = document.getElementById('summary-section');
  const data = BUSINESSES_DATA[currentBusiness]?.[currentPeriod];
  
  if (!data) {
    container.innerHTML = '';
    return;
  }
  
  const cards = [
    { label: 'GGR', value: data['GGR'], format: 'currency', color: 'linear-gradient(135deg, #3b82f6, #1d4ed8)' },
    { label: 'NGR', value: data['NGR'], format: 'currency', color: 'linear-gradient(135deg, #10b981, #059669)' },
    { label: 'T/O', value: data['T/O'], format: 'currency', color: 'linear-gradient(135deg, #8b5cf6, #6d28d9)' },
    { label: 'RTP', value: data['RTP'], format: 'percent', color: 'linear-gradient(135deg, #f59e0b, #d97706)' },
    { label: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼', value: data['ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°'], format: 'number', color: 'linear-gradient(135deg, #ec4899, #db2777)' },
    { label: 'FTDæ•°', value: data['FTDæ•°'], format: 'number', color: 'linear-gradient(135deg, #06b6d4, #0891b2)' },
    { label: 'å›åç‡', value: data['å›åç‡'], format: 'percent', color: 'linear-gradient(135deg, #84cc16, #65a30d)' },
    { label: 'LTV', value: data['LTV'], format: 'currency', color: 'linear-gradient(135deg, #f43f5e, #e11d48)' },
  ];
  
  container.innerHTML = cards.filter(c => c.value != null).map(card => `
    <div class="summary-card" style="background: ${card.color};">
      <h3>${card.label}</h3>
      <div class="value">${formatValue(card.value, card.format)}</div>
    </div>
  `).join('');
}

function formatValue(value, format) {
  if (value == null) return '-';
  switch (format) {
    case 'currency': return 'Â¥' + Math.round(value).toLocaleString();
    case 'percent': return value.toFixed(2) + '%';
    case 'number': return Math.round(value).toLocaleString();
    default: return value;
  }
}

// ===== ãƒãƒ£ãƒ¼ãƒˆ =====
function renderChart() {
  const ctx = document.getElementById('main-chart').getContext('2d');
  const data = BUSINESSES_DATA[currentBusiness] || {};
  const periods = Object.keys(data).sort((a, b) => {
    const [yA, mA] = a.match(/(\d+)å¹´(\d+)æœˆ/).slice(1).map(Number);
    const [yB, mB] = b.match(/(\d+)å¹´(\d+)æœˆ/).slice(1).map(Number);
    return (yA * 12 + mA) - (yB * 12 + mB);
  });
  
  if (chartInstance) chartInstance.destroy();
  
  if (periods.length === 0) {
    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
    return;
  }
  
  chartInstance = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: periods,
      datasets: [
        { label: 'GGR', data: periods.map(p => data[p]?.['GGR'] || 0), backgroundColor: 'rgba(59, 130, 246, 0.7)' },
        { label: 'NGR', data: periods.map(p => data[p]?.['NGR'] || 0), backgroundColor: 'rgba(16, 185, 129, 0.7)' },
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { y: { beginAtZero: true, ticks: { callback: v => 'Â¥' + (v / 1000000).toFixed(0) + 'M' } } }
    }
  });
}

// ===== ãƒªãƒ³ã‚¯ä¸€è¦§ =====
function renderLinks() {
  const section = document.getElementById('links-section');
  const grid = document.getElementById('links-grid');
  
  let links = [];
  if (currentBusiness === 'DSC') links = DSC_LINKS;
  else if (currentBusiness === 'ã‚¹ãƒ­å¤©') links = SLOTEN_LINKS;
  
  if (links.length === 0) {
    section.classList.add('hidden');
    return;
  }
  
  section.classList.remove('hidden');
  
  // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
  const grouped = {};
  links.forEach(link => {
    if (!grouped[link.category]) grouped[link.category] = [];
    grouped[link.category].push(link);
  });
  
  grid.innerHTML = Object.entries(grouped).map(([cat, items]) => `
    <div class="link-category">
      <h4>${cat}ï¼ˆ${items.length}ä»¶ï¼‰</h4>
      <div>${items.map(item => `<a href="${item.url}" target="_blank" class="link-item">${item.name}</a>`).join('')}</div>
    </div>
  `).join('');
}

// ===== ãƒ†ãƒ¼ãƒ–ãƒ« =====
function renderTable() {
  const data = BUSINESSES_DATA[currentBusiness]?.[currentPeriod];
  const header = document.getElementById('table-header');
  const body = document.getElementById('table-body');
  
  if (!data) {
    header.innerHTML = '';
    body.innerHTML = '<tr><td colspan="2" style="text-align:center; padding: 40px; color: #94a3b8;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</td></tr>';
    return;
  }
  
  header.innerHTML = '<th>é …ç›®</th><th class="text-right">å€¤</th>';
  body.innerHTML = Object.entries(data).map(([key, value]) => {
    const formatted = typeof value === 'number' 
      ? (key.includes('ç‡') || key.includes('RTP') ? value.toFixed(2) + '%' : 'Â¥' + Math.round(value).toLocaleString())
      : value;
    return `<tr><td>${key}</td><td class="text-right">${formatted}</td></tr>`;
  }).join('');
}

// ===== ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ =====
function showUploadModal() {
  document.getElementById('upload-modal').classList.remove('hidden');
}

function hideUploadModal() {
  document.getElementById('upload-modal').classList.add('hidden');
}

function setupDragDrop() {
  const zone = document.getElementById('upload-zone');
  zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('dragover'); });
  zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
  zone.addEventListener('drop', e => {
    e.preventDefault();
    zone.classList.remove('dragover');
    if (e.dataTransfer.files[0]) handleFileUpload(e.dataTransfer.files[0]);
  });
}

function handleFileUpload(file) {
  if (!file) return;
  
  const period = document.getElementById('upload-period').value || 'æ–°è¦ãƒ‡ãƒ¼ã‚¿';
  const reader = new FileReader();
  
  reader.onload = function(e) {
    try {
      if (file.name.endsWith('.csv')) {
        // CSVå‡¦ç†
        const text = e.target.result;
        alert('CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’å—ä¿¡ã—ã¾ã—ãŸ: ' + file.name + '\næœŸé–“: ' + period);
      } else {
        // Excelå‡¦ç†
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];
        const json = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        
        alert('Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’å—ä¿¡ã—ã¾ã—ãŸ: ' + file.name + '\nã‚·ãƒ¼ãƒˆ: ' + sheetName + '\nè¡Œæ•°: ' + json.length + '\næœŸé–“: ' + period);
      }
      hideUploadModal();
    } catch (err) {
      alert('ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã‚¨ãƒ©ãƒ¼: ' + err.message);
    }
  };
  
  if (file.name.endsWith('.csv')) {
    reader.readAsText(file);
  } else {
    reader.readAsArrayBuffer(file);
  }
}

// ===== äº‹æ¥­è¿½åŠ ãƒ»å‰Šé™¤ =====
function addBusiness() {
  const name = prompt('æ–°ã—ã„äº‹æ¥­åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
  if (name && name.trim() && !BUSINESSES_DATA[name.trim()]) {
    BUSINESSES_DATA[name.trim()] = {};
    selectBusiness(name.trim());
  }
}

function deleteBusiness() {
  if (Object.keys(BUSINESSES_DATA).length <= 1) {
    alert('æœ€å¾Œã®äº‹æ¥­ã¯å‰Šé™¤ã§ãã¾ã›ã‚“');
    return;
  }
  if (confirm(`ã€Œ${currentBusiness}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
    delete BUSINESSES_DATA[currentBusiness];
    selectBusiness(Object.keys(BUSINESSES_DATA)[0]);
  }
}
  </script>
</body>
</html>
