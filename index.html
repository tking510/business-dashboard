<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>事業別ダッシュボード</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f1f5f9;min-height:100vh}
.container{max-width:1400px;margin:0 auto;padding:20px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:16px}
.header h1{font-size:24px;color:#1e293b}
.header-actions{display:flex;gap:10px;flex-wrap:wrap}
.card{background:white;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,0.06);padding:20px;margin-bottom:20px}
.tabs{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap;align-items:center}
.tab{padding:10px 18px;border-radius:10px;border:none;cursor:pointer;font-size:13px;font-weight:600;transition:all 0.2s;background:#e2e8f0;color:#475569}
.tab:hover{background:#cbd5e1}
.tab.active{background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:white}
.btn{padding:10px 20px;border-radius:10px;border:none;cursor:pointer;font-weight:600;transition:all 0.2s;display:inline-flex;align-items:center;gap:6px}
.btn-primary{background:linear-gradient(135deg,#3b82f6,#1d4ed8);color:white}
.btn-secondary{background:#f1f5f9;color:#475569}
.btn-danger{background:#fee2e2;color:#dc2626}
.btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin-bottom:24px}
.summary-card{border-radius:12px;padding:14px;color:white;background:linear-gradient(135deg,#3b82f6,#1d4ed8)}
.summary-card h3{font-size:10px;opacity:0.9;margin-bottom:4px;text-transform:uppercase}
.summary-card .value{font-size:18px;font-weight:700}
.chart-container{height:300px;margin:20px 0}
.period-selector{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;align-items:center}
.period-btn{padding:6px 14px;border-radius:8px;border:none;cursor:pointer;font-size:12px;background:#f1f5f9;color:#64748b;transition:all 0.2s}
.period-btn.active{background:#3b82f6;color:white}
.period-btn:hover{background:#e2e8f0}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000}
.modal-content{background:white;border-radius:16px;padding:30px;max-width:600px;width:90%;max-height:90vh;overflow-y:auto}
.upload-zone{border:2px dashed #cbd5e1;border-radius:12px;padding:40px;text-align:center;cursor:pointer;transition:all 0.2s}
.upload-zone:hover,.upload-zone.dragover{border-color:#3b82f6;background:#eff6ff}
.hidden{display:none!important}
.links-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;max-height:500px;overflow-y:auto}
.link-category{background:white;border-radius:12px;padding:16px;border:1px solid #e2e8f0}
.link-category h4{font-size:13px;color:#64748b;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid #e2e8f0}
.link-item{display:inline-block;background:#dbeafe;color:#1d4ed8;padding:4px 10px;border-radius:6px;font-size:11px;margin:2px;text-decoration:none;transition:all 0.2s}
.link-item:hover{background:#bfdbfe;transform:translateY(-1px)}
.table-container{overflow-x:auto;max-height:500px}
table{width:100%;border-collapse:collapse;font-size:12px}
th,td{padding:8px 10px;text-align:left;border-bottom:1px solid #e2e8f0}
th{background:#f8fafc;font-weight:600;color:#64748b;position:sticky;top:0}
tr:hover{background:#f8fafc}
.text-right{text-align:right}
.text-green{color:#16a34a}
.text-red{color:#dc2626}
input,select{padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;width:100%}
input:focus,select:focus{outline:none;border-color:#3b82f6}
.form-group{margin-bottom:16px}
.form-group label{display:block;font-size:13px;color:#64748b;margin-bottom:6px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.section-title{font-size:16px;font-weight:600;color:#1e293b;margin-bottom:16px;display:flex;align-items:center;gap:8px}
.kpi-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px}
.kpi-item{background:#f8fafc;border-radius:10px;padding:12px}
.kpi-item .label{font-size:10px;color:#64748b;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.kpi-item .val{font-size:16px;font-weight:700;color:#1e293b}
.kpi-item .val.negative{color:#dc2626}
footer{text-align:center;color:#94a3b8;font-size:11px;margin-top:30px;padding:20px}
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>📊 事業別ダッシュボード</h1>
    <div class="header-actions">
      <button class="btn btn-primary" onclick="showUploadModal()">📤 アップロード</button>
      <button class="btn btn-secondary" onclick="showAddBusinessModal()">➕ 事業追加</button>
    </div>
  </div>
  <div class="tabs" id="business-tabs"></div>
  <div id="period-selector" class="period-selector"></div>
  <div id="summary-section"></div>
  <div class="card">
    <div class="section-title">📈 推移グラフ</div>
    <div class="chart-container"><canvas id="main-chart"></canvas></div>
  </div>
  <div id="kpi-sections"></div>
  <div id="links-section" class="card hidden">
    <div class="section-title" id="links-title">🔗 リンク一覧</div>
    <div id="links-grid" class="links-grid"></div>
  </div>
  <div id="data-table" class="card">
    <div class="section-title">📋 詳細データ</div>
    <div class="table-container">
      <table><thead><tr id="table-header"></tr></thead><tbody id="table-body"></tbody></table>
    </div>
  </div>
  <footer>収益管理ダッシュボード v3.0（完全版）| 元amuse・DSC・スロ天・AMUSEVIP・広告・バカラツール対応</footer>
</div>

<div id="upload-modal" class="modal hidden">
  <div class="modal-content">
    <h3 style="margin-bottom:20px">📤 ファイルアップロード</h3>
    <div class="form-row">
      <div class="form-group"><label>期間</label><input type="text" id="upload-period" placeholder="例: 2025年10月"></div>
      <div class="form-group"><label>データ種別</label>
        <select id="upload-type">
          <option value="auto">自動判別</option>
          <option value="samExcel">元amuse/DSC Excel</option>
          <option value="sloten">スロ天KPIシート</option>
          <option value="agent">AMUSEVIP エージェント</option>
          <option value="ads">広告データ</option>
          <option value="baccarat">バカラツール</option>
          <option value="customerList">顧客リストシート</option>
          <option value="uncollected">未回収シート</option>
          <option value="bonus">ボーナスシート</option>
          <option value="delayed">遅れ回収シート</option>
        </select>
      </div>
    </div>
    <div class="upload-zone" id="upload-zone" onclick="document.getElementById('file-input').click()">
      <div style="font-size:40px;margin-bottom:10px">📁</div>
      <p>クリックまたはドラッグ&ドロップ</p>
      <p style="font-size:12px;color:#94a3b8;margin-top:8px">.xlsx, .xls, .csv 対応</p>
    </div>
    <input type="file" id="file-input" accept=".xlsx,.xls,.csv" style="display:none" onchange="handleFileUpload(this.files[0])">
    <div id="upload-status" style="margin-top:16px;padding:12px;border-radius:8px;display:none"></div>
    <div style="margin-top:20px;display:flex;gap:10px;justify-content:flex-end">
      <button class="btn btn-secondary" onclick="hideUploadModal()">閉じる</button>
    </div>
  </div>
</div>

<div id="add-business-modal" class="modal hidden">
  <div class="modal-content">
    <h3 style="margin-bottom:20px">➕ 事業追加</h3>
    <div class="form-group"><label>事業名</label><input type="text" id="new-business-name" placeholder="例: 新規事業"></div>
    <div class="form-group"><label>事業タイプ</label>
      <select id="new-business-type">
        <option value="samExcel">標準（GGR/NGR等）</option>
        <option value="sloten">スロ天形式</option>
        <option value="agent">エージェント型</option>
        <option value="ads">広告型</option>
        <option value="baccara">ツール型</option>
      </select>
    </div>
    <div style="margin-top:20px;display:flex;gap:10px;justify-content:flex-end">
      <button class="btn btn-secondary" onclick="hideAddBusinessModal()">キャンセル</button>
      <button class="btn btn-primary" onclick="addBusiness()">追加</button>
    </div>
  </div>
</div>

<script>
// ========== データ定義 ==========
const MOTO_AMUSE_DATA = {
  '2025年10月':{サマリー:{'リスト件数':14542.0,'打電数':10579.0,'着電数':1716.0,'LINE登録数':23.0,'アカウント作成数':141.0,'FTP数':82.0,'FTP率':0.5815602837,'FTD数':48.0,'FTD率':0.3404255319,'FTW数':7.0,'FTW率':0.04964539007,'FTDW数':55.0,'FTDW率':0.390070922,'前月リテンション数':75.0,'引継ぎプレイヤー数':153.0,'アクティブユーザー数':294.0,'T/O':1577495817.7,'勝利金':1507184477.51,'RTP':0.9554285093,'GGR(WIN/LOSE)':70311340.19,'LTV(WIN/LOSE)':239154.2183,'回収予定金額':71840329.0,'回収金額':55956778.0,'回収率(全体)':0.7789048126,'回収率(今月)':0.7476,'出金金額':17719827.0,'GGR(回収金額-出金金額)':38174451.0,'LTV(GGR)':129845.0714,'プロバイダーフィー':7263554.56,'NGR':30910896.44,'date':6337611.4,'MS':7129812.825,'人件費':6428256.89,'インセンティブ':1288854.0,'通信費':2663589.51,'ペイメントフィー':2270983.0,'雑費・福利厚生等':1505598.314,'合計経費':14157281.71,'BK':8714215.675,'利益':-5428025.174,'死亡金':62500.0,'凍結制限金':0.0}},
  '2025年9月':{サマリー:{'GGR(WIN/LOSE)':-2176638.6,'LINE登録数':13.0,'LTV(GGR)':0.0,'LTV(WIN/LOSE)':0.0,'RTP':1.038340917,'T/O':56770645.0,'インセンティブ':694111.143,'ペイメントフィー':2503018.658,'リスト件数':14965.0,'人件費':9563363.21,'凍結制限金':238392.0,'勝利金':58947283.6,'合計経費':12887226.88,'打電数':1035.0,'死亡金':0.0,'着電数':665.0,'雑費・福利厚生等':126733.8732}},
  '2025年8月':{サマリー:{'BK':7114855.000000001,'FTDW率':0.5087,'FTD数':12.0,'FTD率':0.2044,'FTP数':60.0,'FTP率':0.7676,'FTW率':0.0984,'GGR(WIN/LOSE)':56952667.0,'GGR(回収金額-出金金額)':27019475.0,'LINE登録数':48.0,'LTV(GGR)':92276.37323943662,'LTV(WIN/LOSE)':389548.0,'MS':5821245.0,'NGR':23459499.0,'RTP':0.9735,'T/O':1910465086.0,'date':5174440.0,'アカウント作成数':78.0,'アクティブユーザー数':284.0,'インセンティブ':598292.4885714286,'プロバイダーフィー':3559976.0,'ペイメントフィー':2215288.0,'ボーナス割合(GGR)':0.047452013062167064,'ボーナス割合(T/O)':0.0010859991798596426,'ボーナス割合(WIN/LOSE)':0.030072299778184534,'リスト件数':9997.0,'人件費':9282938.4,'付与ボーナス額':1396616.0,'凍結制限金':30000.0,'出金金額':13154437.0,'利益':2386980.283149061,'前月リテンション数':88.0,'勝利金':1853512419.0,'合計経費':7321812.716850938,'回収予定金額':56467301.0,'回収率(今月)':0.7759,'回収率(全体)':0.7400168639191733,'回収金額':41786755.0,'引継ぎプレイヤー数':206.0,'打電数':9829.0,'死亡金':782985.0,'着電数':3810.0,'通信費':1318555.9710000001,'雑費・福利厚生等':962870.0549999998}},
  '2025年7月':{サマリー:{'BK':1046146.646,'FTDW数':14.0,'FTDW率':0.208955223880597,'FTD数':11.0,'FTD率':0.16417910447761194,'FTP数':39.0,'FTP率':0.582089552238806,'FTW数':3.0,'FTW率':0.04477611940298507,'GGR(WIN/LOSE)':89408914.42000008,'GGR(回収金額-出金金額)':11754881.9,'LINE登録数':51.0,'LTV(GGR)':34271.25170603676,'LTV(WIN/LOSE)':234669.0667191603,'MS':855938.1645,'NGR':3791600.89,'RTP':0.976180804579324,'T/O':3753649644.37,'date':760833.924,'アカウント作成数':67.0,'アクティブユーザー数':381.0,'インセンティブ':2652236.0,'プロバイダーフィー':7963281.01,'ペイメントフィー':3208612.835,'ボーナス割合(GGR)':0.29803130986739723,'ボーナス割合(T/O)':0.001036723873746916,'ボーナス割合(WIN/LOSE)':0.04352472262127704,'リスト件数':9957.0,'人件費':8251402.2,'付与ボーナス額':3891498.2,'凍結制限金':24154321.0,'出金金額':37542660.0,'利益':-24863723.26,'前月リテンション数':17.0,'勝利金':3664240729.95,'合計経費':25992405.41,'回収予定金額':106737904.30000001,'回収率(今月)':0.668580101586274,'回収率(全体)':0.700354090613338,'回収金額':74754327.9,'引継ぎプレイヤー数':314.0,'打電数':100011.0,'死亡金':0.0,'着電数':3839.0,'雑費・福利厚生等':11880154.38}},
  '2025年6月':{サマリー:{'BK':19008236.94,'GGR(WIN/LOSE)':106821992.9,'GGR(回収金額-出金金額)':79117068.0,'LINE登録数':367.0,'LTV(GGR)':113348.235,'LTV(WIN/LOSE)':153040.1044,'MS':15552193.86,'NGR':69120861.61,'RTP':0.9716264016,'T/O':3764837698.76,'date':13824172.32,'アクティブユーザー数':698.0,'インセンティブ':2602236.0,'プロバイダーフィー':9996206.39,'ペイメントフィー':4270364.007,'ボーナス割合(GGR)':0.08694462742,'ボーナス割合(T/O)':0.001827118338,'ボーナス割合(WIN/LOSE)':0.06439501654,'リスト件数':9884.0,'人件費':8738253.6,'凍結制限金':3542619.0,'利益':4960444.968,'前月リテンション数':235.0,'勝利金':3658015705.86,'合計経費':15775813.52,'打電数':191066.0,'死亡金':785657.0,'着電数':7980.0,'雑費・福利厚生等':164959.908}},
  '2025年5月':{サマリー:{'BK':6910039.37525,'FTDW数':119.0,'FTDW率':0.37658227848101267,'FTD数':110.0,'FTD率':0.34810126582278483,'FTP数':0.0,'FTP率':0.0,'FTW数':9.0,'FTW率':0.028481012658227847,'GGR':30822400.0,'LINE登録数':497.0,'LTV(GGR)':40878.51458885942,'LTV(WIN/LOSE)':3348.1976127320954,'MS':5653668.57975,'NGR':21494893.73,'RTP':0.9995339013616793,'T/O':5416323482.72,'WIN/LOSE':2524541.0,'date':5025483.182,'アカウント作成数':316.0,'アクティブユーザー数':754.0,'インセンティブ':2321349.36,'プロバイダーフィー':9327506.27,'ペイメントフィー':6119490.98130618,'ボーナス割合(GGR)':0.2319400825,'ボーナス割合(T/O)':0.001319889778,'ボーナス割合(WIN/LOSE)':2.831782094,'リスト件数':9967.0,'人件費':8490554.8,'付与ボーナス額':7148950.0,'凍結/返済制限金差し引き後':0.0,'出金金額':74028096.0,'利益':-18474517.926806178,'前月リテンション数':119.0,'勝利金':5413798941.72,'合計経費':22380220.51980618,'回収予定金額':127207474.61999999,'回収率(今月)':0.8334792575414466,'回収率(全体)':0.8490640964506556,'回収金額':108007299.5,'引継ぎプレイヤー数':438.0,'打電数':171257.0,'死亡金':0.0,'着電数':6193.0,'通信費':3679851.593,'雑費・福利厚生等':1768973.7854999998}},
  '2025年4月':{サマリー:{'BK':17221677.536250003,'FTDW数':140.0,'FTDW率':0.6730769230769231,'FTD数':127.0,'FTD率':0.6105769230769231,'FTP数':0.0,'FTP率':0.0,'FTW数':13.0,'FTW率':0.0625,'GGR':69357611.0,'LINE登録数':269.0,'LTV(GGR)':125875.88203266788,'LTV(WIN/LOSE)':146483.1712341196,'MS':14090463.43875,'NGR':62624282.05,'RTP':0.9762702910701644,'T/O':3401315523.45,'WIN/LOSE':80712227.3499999,'date':12524856.39,'アカウント作成数':208.0,'アクティブユーザー数':551.0,'インセンティブ':2171413.456214373,'プロバイダーフィー':6733328.95,'ペイメントフィー':3809073.8074307796,'ボーナス割合(GGR)':0.1120036415,'ボーナス割合(T/O)':0.0022839119,'ボーナス割合(WIN/LOSE)':0.0962469412,'リスト件数':9601.0,'人件費':8664027.12,'付与ボーナス額':7768305.0,'凍結制限金':1069435.0,'出金金額':39921751.0,'利益':-1115819.608045157,'前月リテンション数':74.0,'勝利金':3320603296.1,'合計経費':19903104.293045152,'回収予定金額':122477771.2,'回収率(今月)':0.8932255455674066,'回収率(全体)':0.9380129787992092,'回収金額':114885739.0,'引継ぎプレイヤー数':343.0,'打電数':95781.0,'死亡金':9951.0,'着電数':4488.0,'通信費':4398883.113399999,'雑費・福利厚生等':859706.7959999999}},
  '2025年3月':{サマリー:{'BK':20231773.1,'FTDW数':110.0,'FTDW率':0.6918238993710691,'FTD数':103.0,'FTD率':0.6477987421383647,'FTP数':0.0,'FTP率':0.0,'FTW数':7.0,'FTW率':0.0440251572327044,'GGR':88303648.0,'LINE登録数':207.0,'LTV(GGR)':194073.95164835165,'LTV(WIN/LOSE)':148976.18692307628,'MS':16553268.9,'NGR':73575372.0,'RTP':0.9736721903859757,'T/O':2574622273.7,'WIN/LOSE':67784165.04999971,'date':14714016.8,'アカウント作成数':159.0,'アクティブユーザー数':455.0,'インセンティブ':2820238.0672227424,'プロバイダーフィー':14728276.0,'ペイメントフィー':3926519.78232346,'ボーナス割合(GGR)':0.0619994431,'ボーナス割合(T/O)':0.002126438917,'ボーナス割合(WIN/LOSE)':0.08076778693,'リスト件数':6976.0,'人件費':8612133.32,'付与ボーナス額':5474777.0,'凍結制限金':1398639.0,'出金金額':45743713.0,'利益':2110802.3558537997,'前月リテンション数':56.0,'勝利金':2506838108.65,'合計経費':19965510.844146203,'回収予定金額':144998394.60000002,'回収率(今月)':0.9392787332281263,'回収率(全体)':0.9576673644081849,'回収金額':138860230.4,'引継ぎプレイヤー数':296.0,'打電数':63823.0,'死亡金':230445.0,'着電数':4040.0,'通信費':2597834.8896000003,'雑費・福利厚生等':2008784.7850000001}},
  '2025年2月':{サマリー:{'BK':19184425.425,'FTDW数':85.0,'FTDW率':0.7522123893805309,'FTD数':78.0,'FTD率':0.6902654867256637,'FTP数':0.0,'FTP率':0.0,'FTW数':7.0,'FTW率':0.061946902654867256,'GGR':76779202.0,'LINE登録数':223.0,'LTV(GGR)':208073.71815718157,'LTV(WIN/LOSE)':217862.13301707347,'MS':15696348.075000001,'NGR':69761547.49,'RTP':0.9698197160659708,'T/O':2663696844.57,'WIN/LOSE':80391127.08330011,'date':13952309.4,'アカウント作成数':113.0,'アクティブユーザー数':369.0,'インセンティブ':2791896.7479009246,'プロバイダーフィー':7017654.51,'ペイメントフィー':3579173.1690677297,'ボーナス割合(GGR)':0.06294879178,'ボーナス割合(T/O)':0.001814454978,'ボーナス割合(WIN/LOSE)':0.06012054036,'リスト件数':5948.0,'人件費':7698231.538586,'付与ボーナス額':4833158.0,'出金金額':25727451.0,'利益':3069920.2172453403,'前月リテンション数':75.0,'勝利金':2583305717.4867,'合計経費':17858544.372754652,'回収予定金額':105750924.0,'回収率(今月)':0.9311792679939137,'回収率(全体)':0.9939495603839831,'回収金額':105111084.42,'引継ぎプレイヤー数':256.0,'打電数':47811.0,'求人':58240.0,'着電数':4970.0,'管理費':0.0,'通信費':2247465.7452000002,'雑費・福利厚生等':1483537.172}},
  '2025年1月':{サマリー:{'BK':17486751.425,'FTDW数':123.0,'FTDW率':0.825503355704698,'FTD数':119.0,'FTD率':0.7986577181208053,'FTP数':0.0,'FTP率':0.0,'FTW数':4.0,'FTW率':0.026845637583892617,'GGR':72496605.0,'LINE登録数':213.0,'LTV(GGR)':203071.72268907563,'LTV(WIN/LOSE)':275242.73389355745,'MS':14307342.075000001,'NGR':64523087.0,'RTP':0.9730057316741978,'T/O':3640093327.0,'WIN/LOSE':98261656.0,'date':12717637.4,'アカウント作成数':149.0,'アクティブユーザー数':357.0,'インセンティブ':1423950.8,'プロバイダーフィー':7973518.0,'ペイメントフィー':5257213.0,'ボーナス割合(GGR)':0.06833423441,'ボーナス割合(T/O)':0.001360954117,'ボーナス割合(WIN/LOSE)':0.05041641065,'リスト件数':4231.0,'人件費':4770077.82,'付与ボーナス額':4954000.0,'出金金額':57374896.0,'利益':4305227.432560001,'前月リテンション数':60.0,'勝利金':3541831671.0,'合計経費':15706128.667439999,'回収予定金額':146490822.6,'回収率(今月)':0.906,'回収率(全体)':0.8814224789532993,'回収金額':129120304.0,'引継ぎプレイヤー数':208.0,'打電数':31156.0,'求人':59113.6,'着電数':3724.0,'管理費':100000.0,'通信費':1944598.7299999997,'雑費・福利厚生等':2151174.7174400003}},
  '2024年12月':{サマリー:{'BK':31267830.687500004,'FTDW数':96.0,'FTDW率':0.8648648648648649,'FTD数':89.0,'FTD率':0.8018018018018018,'FTP数':0.0,'FTP率':0.0,'FTW数':7.0,'FTW率':0.06306306306306306,'GGR':124135759.0,'LINE登録数':177.0,'LTV(GGR)':347719.21288515406,'LTV(WIN/LOSE)':356286.97478991596,'MS':25582770.5625,'NGR':113701202.0,'RTP':0.9824615567257349,'T/O':7252322684.0,'WIN/LOSE':127194450.0,'date':22740240.5,'アカウント作成数':111.0,'アクティブユーザー数':357.0,'インセンティブ':3307845.12,'エージェントフィー':14897141.0,'プロバイダーフィー':10434557.0,'ペイメントフィー':4537279.0,'ボーナス割合(GGR)':0.02582253515,'ボーナス割合(T/O)':0.0004419963286,'ボーナス割合(WIN/LOSE)':0.02520157129,'リスト件数':5492.0,'人件費':5647561.0,'付与ボーナス額':3205500.0,'出金金額':64423375.0,'利益':14835.06419999525,'前月リテンション数':60.0,'勝利金':7125128234.0,'合計経費':34095525.1858,'回収予定金額':200248158.0,'回収率(今月)':0.9631,'回収率(全体)':0.9504456864966518,'回収金額':190324998.0,'引継ぎプレイヤー数':246.0,'打電数':37455.0,'着電数':4104.0,'管理費':271142.0,'通信費':2409571.8628,'雑費・福利厚生等':3024985.2030000007}},
  '2024年11月':{サマリー:{'BK':13341326.350000001,'FTDW数':128.0,'FTDW率':0.847682119205298,'FTD数':123.0,'FTD率':0.8145695364238411,'FTP数':0.0,'FTP率':0.0,'FTW数':5.0,'FTW率':0.033112582781456956,'GGR':49324294.67999999,'LINE登録数':238.0,'LTV(GGR)':161190.50549019605,'LTV(WIN/LOSE)':210263.38235294117,'MS':10915630.65,'NGR':43746819.67999999,'RTP':0.9732112575773562,'T/O':2401777358.0,'WIN/LOSE':64340595.0,'date':9702782.8,'アカウント作成数':151.0,'アクティブユーザー数':306.0,'インセンティブ':921922.56,'プロバイダーフィー':5577475.0,'ペイメントフィー':3361457.0,'ボーナス割合(GGR)':0.07308771516,'ボーナス割合(T/O)':0.001500971765,'ボーナス割合(WIN/LOSE)':0.05602994501,'リスト件数':34638.0,'人件費':3842181.0,'付与ボーナス額':3605000.0,'出金金額':33439172.0,'利益':-1616452.0224000067,'前月リテンション数':75.0,'勝利金':2337436763.0,'合計経費':11403531.902400002,'回収予定金額':91106410.42,'回収率(今月)':0.936,'回収率(全体)':0.9084263807394113,'回収金額':82763466.67999999,'引継ぎプレイヤー数':155.0,'打電数':41317.0,'求人':0.0,'着電数':4881.0,'管理費':287744.0,'通信費':2186955.4064,'雑費・福利厚生等':803271.936}},
  '2024年10月':{サマリー:{'BK':8506102.30822,'FTDW数':119.0,'FTDW率':0.7391304347826086,'FTD数':114.0,'FTD率':0.7080745341614907,'FTP数':0.0,'FTP率':0.0,'FTW数':5.0,'FTW率':0.031055900621118012,'GGR':35789786.08,'LINE登録数':266.0,'LTV(GGR)':135055.79652830187,'LTV(WIN/LOSE)':211026.42641509435,'MS':6959538.252179999,'NGR':30881235.08,'RTP':0.9741064695491694,'T/O':2159690163.0,'WIN/LOSE':55922003.0,'date':6186256.224160001,'アカウント作成数':161.0,'アクティブユーザー数':265.0,'インセンティブ':1140583.05,'プロバイダーフィー':4908551.0,'ペイメントフィー':1970099.0,'ボーナス割合(GGR)':0.05057308797,'ボーナス割合(T/O)':0.0008380831802,'ボーナス割合(WIN/LOSE)':0.03236650876,'リスト件数':10278.0,'人件費':2795952.0,'付与ボーナス額':1810000.0,'出金金額':21652354.7,'利益':789247.2186399996,'前月リテンション数':67.0,'勝利金':2103768160.0,'合計経費':8440091.0768,'回収予定金額':70318275.1,'回収率(今月)':0.8791,'回収率(全体)':0.822507253310029,'回収金額':57837291.31,'引継ぎプレイヤー数':104.0,'打電数':35815.0,'求人':0.0,'着電数':4262.0,'管理費':269960.0,'通信費':1536157.6258,'雑費・福利厚生等':727339.401}},
  '2024年9月':{サマリー:{'BK':-2309131.5562699996,'FTDW数':114.0,'FTDW率':0.7651006711409396,'FTD数':110.0,'FTD率':0.738255033557047,'FTP数':0.0,'FTP率':0.0,'FTW数':4.0,'FTW率':0.026845637583892617,'GGR':-8983894.0,'LINE登録数':198.0,'LTV(GGR)':-43611.1359223301,'LTV(WIN/LOSE)':11391.329417475219,'MS':-1889289.4551299997,'NGR':-9323620.0,'RTP':0.9983143747196472,'T/O':1392132573.8,'WIN/LOSE':2346613.859999895,'date':-1679368.4045600002,'アカウント作成数':149.0,'アクティブユーザー数':206.0,'インセンティブ':0.0,'プロバイダーフィー':339726.0,'ペイメントフィー':555581.0,'ボーナス割合(GGR)':-0.08459583339,'ボーナス割合(T/O)':0.0005459250177,'ボーナス割合(WIN/LOSE)':0.3238709244,'リスト件数':14000.0,'人件費':1342159.0,'付与ボーナス額':760000.0,'出金金額':64758806.0,'利益':-8734465.30404,'前月リテンション数':62.0,'勝利金':1389785959.94,'合計経費':5288634.72,'回収予定金額':66130411.400000006,'回収率(今月)':0.9134,'回収率(全体)':0.8434079089972212,'回収金額':55774912.0,'引継ぎプレイヤー数':57.0,'打電数':12626.0,'求人':362299.0,'着電数':1610.0,'管理費':303595.0,'通信費':2023594.0,'雑費・福利厚生等':701406.72}},
  '2024年8月':{サマリー:{'BK':6990563.6735000005,'FTDW数':89.0,'FTDW率':0.664179104477612,'FTD数':79.0,'FTD率':0.5895522388059702,'FTP数':0.0,'FTP率':0.0,'FTW数':10.0,'FTW率':0.07462686567164178,'GGR':30099722.0,'LINE登録数':200.0,'LTV(GGR)':242739.6935483871,'LTV(WIN/LOSE)':472282.3306451613,'MS':5719552.0965,'NGR':25420232.0,'RTP':0.9743565934858963,'T/O':2283745296.0,'WIN/LOSE':58563009.0,'date':5084046.308,'アカウント作成数':134.0,'アクティブユーザー数':124.0,'インセンティブ':1028965.2954500001,'プロバイダーフィー':4679490.0,'ペイメントフィー':1135110.0,'リスト件数':16000.0,'人件費':1337726.0,'出金金額':17978411.0,'利益':250449.17340440117,'前月リテンション数':11.0,'勝利金':2225182287.0,'合計経費':7375620.7485956,'回収予定金額':67593085.50999999,'回収率(今月)':0.6736,'回収率(全体)':0.6735696294447797,'回収金額':45528649.56,'引継ぎプレイヤー数':-10.0,'打電数':18177.0,'求人':1580391.0,'着電数':1927.0,'管理費':299012.0,'通信費':1044455.0,'雑費・福利厚生等':949961.4531456}},
  '2024年7月':{サマリー:{'BK':673606.0,'FTDW数':52.0,'FTDW率':0.7647058823529411,'FTD数':50.0,'FTD率':0.7352941176470589,'FTP数':0.0,'FTP率':0.0,'FTW数':2.0,'FTW率':0.029411764705882353,'GGR':2884957.0,'LINE登録数':130.0,'LTV(GGR)':49740.637931034486,'LTV(WIN/LOSE)':119591.25862068965,'MS':0.0,'NGR':2302646.8,'RTP':0.9464850771770864,'T/O':129614183.0,'WIN/LOSE':6936293.0,'date':0.0,'アカウント作成数':68.0,'アクティブユーザー数':58.0,'インセンティブ':19125.0,'プロバイダーフィー':582310.2,'ペイメントフィー':111317.0,'リスト件数':10000.0,'人件費':1564063.0,'出金金額':1230324.0,'利益':-449753.65000000014,'前月リテンション数':0.0,'勝利金':122677890.0,'合計経費':2078794.45,'回収予定金額':5432157.6,'回収率':0.757577615200266,'回収金額':4115281.0,'引継ぎプレイヤー数':0.0,'打電数':19000.0,'求人':0.0,'着電数':2542.0,'管理費':299012.0,'通信費':67430.0,'雑費・福利厚生等':17847.449999999997}},
};
const DSC_DATA = {
  '2026年1月':{サマリー:{'FTDW数':12.0,'FTDW率':0.6,'FTD数':10.0,'FTD率':0.5,'FTP数':16.0,'FTP率':0.8,'FTW数':2.0,'FTW率':0.1,'GGR(WIN/LOSE)':43248155.21,'GGR(回収金額-出金金額)':22191922.0,'LTV(GGR)':128277.0058,'LTV(WIN/LOSE)':249989.3365,'NGR':20776887.34,'RTP':0.9677818663,'T/O':1342354453.62,'アカウント作成数':20.0,'アクティブユーザー数':173.0,'インセンティブ':6560991.0,'プロバイダーフィー':1415034.66,'ペイメントフィー':748513.0,'リスト件数':15000.0,'人件費':1755733.0,'凍結制限金':0.0,'出金金額':12883059.0,'前月リテンション数':0.0,'勝利金':1299106298.41,'合計経費':11136415.2,'回収予定金額':43803701.0,'回収率(全体)':0.800730993,'回収金額':35074981.0,'死亡金':0.0,'通信費':2071178.2}},
  '2025年12月':{サマリー:{'FTDW数':1.0,'FTD数':1.0,'FTP数':8.0,'FTW数':0.0,'GGR(WIN/LOSE)':53578505.81999993,'GGR(回収金額-出金金額)':38616975.0,'LTV(GGR)':133161.9827586207,'LTV(WIN/LOSE)':184753.46834482736,'MS経費':24956219.12,'NGR':31242527.0,'RTP':0.9646170041907816,'T/O':1514244472.37,'アカウント作成数':27.0,'アクティブユーザー数':292.0,'インセンティブ':213423.0,'スロ天経費':15473688.0,'プロバイダーフィー':7374448.0,'ペイメントフィー':2468559.0,'人件費':8554792.14,'凍結制限金':2350603.0,'出金金額':20555338.0,'前月リテンション数':0.0,'勝利金':1460665966.55,'合計経費':62559986.46,'回収予定金額':73458827.0,'回収率(全体)':0.8381212512418691,'回収金額':61567404.0,'死亡金':44488.0,'通信費':10167741.34,'雑費・福利厚生等':725563.8642}},
  '2025年11月':{サマリー:{'BK':9242926.55,'FTDW数':62.0,'FTDW率':0.8051948051948052,'FTD数':29.0,'FTD率':0.37662337662337664,'FTP数':61.0,'FTP率':0.7922077922077922,'FTW数':33.0,'FTW率':0.42857142857142855,'GGR(WIN/LOSE)':64900999.09000015,'GGR(回収金額-出金金額)':43448785.0,'LINE登録数':38.0,'LTV(GGR)':191404.3392,'LTV(WIN/LOSE)':285907.48497797427,'MS':7562394.45,'NGR':33610642.28,'RTP':0.9586145030642917,'T/O':1568206349.94,'date':6722128.4,'アカウント作成数':77.0,'アクティブユーザー数':227.0,'インセンティブ':201803.9925,'プロバイダーフィー':9838142.724,'ペイメントフィー':1723439.0,'リスト件数':14867.0,'人件費':7068636.86,'凍結制限金':995000.0,'出金金額':19725328.0,'利益':-5213977.576,'前月リテンション数':82.0,'勝利金':1503305350.85,'合計経費':15297170.45,'回収予定金額':77447062.0,'回収率(今月)':0.7476,'回収率(全体)':0.829128947460912,'回収金額':64213601.0,'引継ぎプレイヤー数':150.0,'打電数':10398.0,'死亡金':44488.0,'着電数':1209.0,'通信費':4349824.944,'雑費・福利厚生等':1953465.656}},
  '2025年9月':{サマリー:{'BK':8671957.8,'FTDW数':92.0,'FTDW率':0.3948497854077253,'FTD数':73.0,'FTD率':0.3133047210300429,'FTP数':154.0,'FTP率':0.6609442060085837,'FTW数':19.0,'FTW率':0.0815450643776824,'GGR(WIN/LOSE)':74174997.0,'GGR(回収金額-出金金額)':40783402.0,'LINE登録数':161.0,'LTV(GGR)':137774.1711409396,'LTV(WIN/LOSE)':248909.38590604026,'MS':7095238.2,'NGR':31772784.0,'RTP':0.9712296388169991,'T/O':2578173994.0,'date':6306878.4,'アカウント作成数':233.0,'アクティブユーザー数':298.0,'インセンティブ':694111.143,'プロバイダーフィー':9010618.0,'ペイメントフィー':2503018.658,'ボーナス割合(GGR)':0.020361108879103126,'ボーナス割合(T/O)':0.00032424498964983355,'ボーナス割合(WIN/LOSE)':0.011270104938460597,'リスト件数':14807.0,'人件費':9563363.21,'付与ボーナス額':835960.0,'凍結制限金':238392.0,'出金金額':21551493.0,'利益':-6498484.284,'前月リテンション数':21.0,'勝利金':2503998997.0,'合計経費':16197193.88,'回収予定金額':76698566.8,'回収率(全体)':0.8193971624512807,'回収金額':62846588.0,'引継ぎプレイヤー数':65.0,'打電数':12471.0,'死亡金':0.0,'着電数':2418.0,'通信費':3309967.0,'雑費・福利厚生等':126733.8732}},
  '2025年8月':{サマリー:{'FTDW率':0.3114754098360656,'FTD数':7.0,'FTD率':0.11475409836065574,'FTP数':47.0,'FTP率':0.7704918032786885,'FTW率':0.19672131147540983,'GGR(WIN/LOSE)':10510724.930000067,'GGR(回収金額-出金金額)':-1612843.0,'LINE登録数':9.0,'LTV(GGR)':-11946.985185185185,'LTV(WIN/LOSE)':77857.2217037042,'NGR':-1612843.0,'RTP':0.9831679120186414,'T/O':624445698.1,'アカウント作成数':61.0,'アクティブユーザー数':135.0,'ボーナス割合(GGR)':-0.5183145538654413,'ボーナス割合(T/O)':0.001338723290982025,'ボーナス割合(WIN/LOSE)':0.07953400032513216,'リスト件数':9997.0,'付与ボーナス額':835960.0,'出金金額':3822454.0,'利益':-1612843.0,'前月リテンション数':85.0,'勝利金':613934973.17,'合計経費':0.0,'回収予定金額':10279262.0,'回収率(今月)':0.21495813609965383,'回収率(全体)':0.21495813609965383,'回収金額':2209611.0,'引継ぎプレイヤー数':74.0,'打電数':0.0,'死亡金':0.0,'着電数':56.0}},
  '2025年7月':{サマリー:{'FTDW数':14.0,'FTDW率':0.208955223880597,'FTD数':11.0,'FTD率':0.16417910447761194,'FTP数':39.0,'FTP率':0.582089552238806,'FTW数':3.0,'FTW率':0.04477611940298507,'GGR(WIN/LOSE)':89408914.42000008,'GGR(回収金額-出金金額)':-1302465.0,'LINE登録数':51.0,'LTV(GGR)':34271.25170603676,'LTV(WIN/LOSE)':234669.0667191603,'NGR':-1758164.69,'RTP':0.976180804579324,'T/O':3753649644.37,'アカウント作成数':67.0,'アクティブユーザー数':381.0,'インセンティブ':2652236.0,'プロバイダーフィー':455699.69,'ペイメントフィー':3208612.835,'ボーナス割合(GGR)':0.29803130986739723,'ボーナス割合(T/O)':0.001036723873746916,'ボーナス割合(WIN/LOSE)':0.04352472262127704,'リスト件数':9957.0,'人件費':8251402.2,'付与ボーナス額':3891498.2,'凍結制限金':24154321.0,'出金金額':37542660.0,'前月リテンション数':17.0,'勝利金':3664240729.95,'合計経費':25992405.41,'回収予定金額':106737904.30000001,'回収率(今月)':0.668580101586274,'回収率(全体)':0.700354090613338,'回収金額':74754327.9,'引継ぎプレイヤー数':314.0,'打電数':100011.0,'死亡金':0.0,'着電数':3839.0,'雑費・福利厚生等':11880154.38}},
};
const SLOTEN_DATA = {
  '2026年1月':{
    サマリー:{'登録人数':3381,'ログインユーザー数':3459,'FTDのみ入金者数':181,'2ndのみ入金者数':36,'3nd入金以降ユーザー数':32,'4nd入金以降ユーザー数':90,'今月登録のFTD以降ユーザー数':339,'今月登録FTD以降ユーザー割合':0.1002661934,'今月登録のアクティブユーザー数':339,'前月登録のアクティブユーザー数':593,'前々月登録のアクティブユーザー数':61,'3か月以上アクティブプレイヤー数':0,'登録に対して1st使用割合':0.03599546043,'登録に対して2nd使用割合':0.00870977633,'登録に対して3nd使用割合':0.005506187328,'登録に対して4nd使用割合':0.008197898177,'アクティブプレイ人数（ユニーク）':993,'入金者数(デイリーユニーク)':632,'総入金額':70601802,'総出金額':54836317,'総入金回数':4925,'T/O(リアルのみ)':1040015674,'勝利金(リアルのみ)':1009478892,'RTP':0.9730691653,'GGR':30536782.75,'入出金差分':15765485,'GGRLTV':30752.04708},
    入金方法:{'TOTAL':70601802,'銀行（自動）':16021000,'仮想通貨':6063158,'銀行（手動）':7798951,'EC(コンビニ)':1472000,'PayPay':39246693},
    出金方法:{'TOTAL':54836317,'銀行（自動）':16360710,'仮想通貨':17794551,'銀行（手動）':19212554,'PayPay':1468502},
    ゲーム別:{パチンコ:{ユーザー数:1066,TO:25539221,GGR:3124886},パチスロ:{ユーザー数:1090,TO:120877774,GGR:1119651},スロット:{ユーザー数:4792,TO:388796058,GGR:10550937},ライブ:{ユーザー数:2213,TO:407528253,GGR:15111844}},
    Affiliate:{'AFF数':46,'AFF経由登録者数':925,'AFF経由FTD数':126,'AFF経由FTD率':0.1362,'AFF経由入金額':8022259,'AFF経由出金額':5490590,'AFF経由GGR':2531669}
  },
  '2025年12月':{
    サマリー:{'登録人数':2552,'ログインユーザー数':2399,'FTDのみ入金者数':231,'2nd入金のみユーザー数':66,'3nd入金のみユーザー数':30,'4nd入金以降ユーザー数':45,'今月登録のFTD以降ユーザー数':713,'今月登録FTD以降ユーザー割合':0.1653068759,'今月登録のアクティブユーザー数':768,'前月登録のアクティブユーザー数':76,'前々月登録のアクティブユーザー数':0,'3か月以上アクティブプレイヤー数':0,'登録に対してFTDのみの割合':0.08425045538,'登録に対して2nd使用割合':0.02872426151,'登録に対して3nd使用割合':0.01715161771,'登録に対して4nd使用割合':0.0351805413,'アクティブプレイ人数（ユニーク）':798,'入金者数(デイリーユニーク)':2234,'総入金額':66633871,'総出金額':48341793,'総入金回数':3948,'T/O(リアルのみ)':1120432234,'勝利金(リアルのみ)':1084887870,'RTP':0.9660437644,'GGR':35543975.96,'入出金差分':18292078,'GGRLTV':44541.32326},
    入金方法:{'TOTAL':66633871,'銀行（自動）':11122808,'仮想通貨':10897654,'銀行（手動）':18865520,'EC(コンビニ)':1121000,'PayPay':7455811},
    出金方法:{'TOTAL':48341793,'銀行（自動）':0,'仮想通貨':0,'銀行（手動）':0,'PayPay':0},
    ゲーム別:{パチンコ:{ユーザー数:0,TO:0,GGR:0},パチスロ:{ユーザー数:0,TO:0,GGR:0},スロット:{ユーザー数:0,TO:0,GGR:0},ライブ:{ユーザー数:0,TO:0,GGR:0}},
    Affiliate:{'AFF数':34,'AFF経由登録者数':1457,'AFF経由FTD数':543,'AFF経由FTD率':0.3727,'AFF経由入金額':55061952,'AFF経由出金額':36735633,'AFF経由GGR':10366161}
  },
  '2025年11月':{
    サマリー:{'登録人数':300,'ログインユーザー数':193,'FTD数':8,'2nd入金以降ユーザー数':10,'3nd入金以降ユーザー数':3,'4nd入金以降ユーザー数':21,'今月登録のFTD以降ユーザー数':42,'今月登録FTD以降ユーザー割合':0.5660971822,'今月登録のアクティブユーザー数':0,'前月登録のアクティブユーザー数':0,'前々月登録のアクティブユーザー数':0,'3か月以上アクティブプレイヤー数':0,'登録に対して1st使用割合':0.06347826087,'登録に対して2nd使用割合':0.1197670807,'登録に対して3nd使用割合':0.01863354037,'登録に対して4nd使用割合':0.3642183003,'アクティブプレイ人数':84,'入金者数(ユニーク)':32,'総入金額':586146,'総出金額':528463,'総入金回数':44,'T/O(リアルのみ)':5043994.2,'勝利金(リアルのみ)':4980421.4,'RTP':3.824506379,'GGR':63572.8,'入出金差分':57683},
    入金方法:{'TOTAL':586146,'銀行（自動）':0,'仮想通貨':8000,'銀行（手動）':100000,'EC(コンビニ)':10000,'PayPay':410463},
    出金方法:{'TOTAL':528463,'銀行（自動）':0,'仮想通貨':0,'銀行（手動）':0,'PayPay':0},
    ゲーム別:{パチンコ:{ユーザー数:0,TO:0,GGR:0},パチスロ:{ユーザー数:0,TO:0,GGR:0},スロット:{ユーザー数:0,TO:0,GGR:0},ライブ:{ユーザー数:0,TO:0,GGR:0}},
    Affiliate:{'AFF数':8,'AFF経由登録者数':302,'AFF経由FTD数':34,'AFF経由FTD率':0.4797,'AFF経由入金額':0,'AFF経由出金額':0,'AFF経由GGR':0}
  },
};
const DSC_LINKS = [
  { category: 'WELCOMELP', name: 'メイン', url: 'https://lp.diamond-secret.club/' },
  { category: 'WELCOMELP', name: '1', url: 'https://lp.diamond-secret.club/1/' },
  { category: 'WELCOMELP', name: 'A', url: 'https://lp.diamond-secret.club/A/' },
  { category: 'WELCOMELP', name: 'BIZ', url: 'https://lp.diamond-secret.club/BIZ/' },
  { category: 'WELCOMELP', name: 'AR', url: 'https://lp.diamond-secret.club/AR/' },
  { category: 'WELCOMELP', name: 'NA', url: 'https://lp.diamond-secret.club/NA/' },
  { category: 'WELCOMELP', name: 'OO', url: 'https://lp.diamond-secret.club/OO/' },
  { category: 'WELCOMELP', name: 'SK', url: 'https://lp.diamond-secret.club/SK/' },
  { category: 'WELCOMELP', name: 'TK', url: 'https://lp.diamond-secret.club/TK/' },
  { category: '開運LP', name: 'メイン', url: 'https://lp.diamond-secret.club/KAIUN/' },
  { category: '開運LP', name: 'AR', url: 'https://lp.diamond-secret.club/KAIUN/AR' },
  { category: '開運LP', name: 'NK', url: 'https://lp.diamond-secret.club/KAIUN/NK' },
  { category: '開運LP', name: 'OO', url: 'https://lp.diamond-secret.club/KAIUN/OO' },
  { category: '開運LP', name: 'SU', url: 'https://lp.diamond-secret.club/KAIUN/SU' },
  { category: '開運LP', name: 'TK', url: 'https://lp.diamond-secret.club/KAIUN/TK' },
  { category: 'クレジットLP', name: 'メイン', url: 'https://lp.diamond-secret.club/2/' },
  { category: 'UPSLP', name: 'メイン', url: 'https://lp.diamond-secret.club/3/' },
  { category: '10日間無利息LP', name: 'メイン', url: 'https://lp.diamond-secret.club/10days/' },
  { category: '10日間無利息LP', name: 'AR', url: 'https://lp.diamond-secret.club/10days/AR/' },
  { category: '10日間無利息LP', name: 'NK', url: 'https://lp.diamond-secret.club/10days/NK/' },
  { category: '10日間無利息LP', name: 'OO', url: 'https://lp.diamond-secret.club/10days/OO/' },
  { category: '10日間無利息LP', name: 'SU', url: 'https://lp.diamond-secret.club/10days/SU/' },
  { category: '10日間無利息LP', name: 'TK', url: 'https://lp.diamond-secret.club/10days/TK/' },
  { category: 'キャンペーンLP', name: 'バカラ大会', url: 'https://lp.diamond-secret.club/Amusebacarrat/' },
  { category: 'キャンペーンLP', name: '勝ちバック', url: 'https://lp.diamond-secret.club/Amusewinboost/' },
  { category: 'キャンペーンLP', name: '宝くじ', url: 'https://lp.diamond-secret.club/DREEEEAMBIG/' },
  { category: 'キャンペーンLP', name: 'リボプレイ', url: 'https://lp.diamond-secret.club/RevoPlay/' },
  { category: 'キャンペーンLP', name: 'スロットカンスト', url: 'https://lp.diamond-secret.club/SlotCanteen/' },
  { category: 'キャンペーンLP', name: 'バカラ広告用', url: 'https://lp.diamond-secret.club/bacarat300/' },
  { category: 'キャンペーンLP', name: 'BaccratMillion', url: 'https://lp.diamond-secret.club/BaccratMillion/' },
  { category: 'キャンペーンLP', name: 'PayPay', url: 'https://lp.diamond-secret.club/PayPay/' },
  { category: '野球LP', name: 'メイン', url: 'https://lp.diamond-secret.club/baseball/' },
  { category: '野球LP', name: 'AR', url: 'https://lp.diamond-secret.club/baseball/AR/' },
  { category: '野球LP', name: 'NK', url: 'https://lp.diamond-secret.club/baseball/NK/' },
  { category: '野球告知用LP', name: 'メイン', url: 'https://lp.diamond-secret.club/baseballm/' },
  { category: 'maxkaitori', name: 'メイン', url: 'https://lp.diamond-secret.club/maxkaitori/' },
  { category: 'maxkaitori', name: 'BIZ', url: 'https://lp.diamond-secret.club/maxkaitori/BIZ/' },
  { category: 'maxkaitori', name: 'G', url: 'https://lp.diamond-secret.club/maxkaitori/G/' },
  { category: 'maxkaitori', name: 'T', url: 'https://lp.diamond-secret.club/maxkaitori/T/' },
  { category: 'maxkaitori', name: 'X', url: 'https://lp.diamond-secret.club/maxkaitori/X/' },
  { category: 'maxkaitori', name: 'Y', url: 'https://lp.diamond-secret.club/maxkaitori/Y/' },
  { category: 'ツール', name: 'MOL', url: 'https://lp.diamond-secret.club/MASTEROFLUCK/' },
  { category: 'ツール', name: 'MOL管理画面', url: 'https://lp.diamond-secret.club/MASTEROFLUCK/admin.html' },
  { category: 'ツール', name: '暴露ページ', url: 'https://bakurozukan.com/' },
  { category: 'ツール', name: '入出金プラットフォーム', url: 'https://tking510.github.io/point_exchange_platform/' },
  { category: 'ツール', name: 'ギャンブル占い', url: 'https://tking510.github.io/uranai/' },
  { category: 'ツール', name: 'スロット図鑑', url: 'https://tking510.github.io/Slotzukan/' },
  { category: 'その他', name: 'ゲーム広告用', url: 'https://lp.diamond-secret.club/game/' },
  { category: 'その他', name: 'SLOTENTEST', url: 'https://lp.diamond-secret.club/SLOTENTEST/' },
  { category: 'その他', name: '高配当買取', url: 'https://lp.diamond-secret.club/ReplayLink/' },
  { category: 'その他', name: '5のつく日CB', url: 'https://lp.diamond-secret.club/5day/' },
  { category: 'その他', name: '9のつく日6確定', url: 'https://lp.diamond-secret.club/9day/' },
  { category: 'その他', name: 'エージェント向け', url: 'https://lp.diamond-secret.club/agentsimulator/' },
  { category: 'その他', name: 'ハイレート', url: 'https://lp.diamond-secret.club/Hiratepachi2/' },
  { category: 'その他', name: '３のつく日', url: 'https://lp.diamond-secret.club/complete/' },
  { category: 'その他', name: 'ステーキング', url: 'https://lp.diamond-secret.club/staking/' },
];
const SLOTEN_LINKS = [
  { category: '全部署', name: '管理画面BO', url: 'https://admin.sloten.io/' },
  { category: '全部署', name: 'シフト', url: 'https://docs.google.com/spreadsheets/d/1tR0hRKy7wyKMc9Nk1MhQ_kOqs3Acg6LoG-nau1VETIA/edit?usp=sharing' },
  { category: '全部署', name: '公式サイト', url: 'https://sloten.io/' },
  { category: '全部署', name: 'USPLP①(AFF用)', url: 'https://affiliate2.sloten.io/' },
  { category: '全部署', name: '開発リクエストテンプレ', url: 'https://docs.google.com/spreadsheets/d/1qjfoPKpugtf9flrfDsdHHsnLQyIM6ARI4EmPJ-_EYGY/edit?usp=sharing' },
  { category: '全部署', name: 'デザイン依頼', url: 'https://docs.google.com/document/d/1aZeeeN3jeTOtFIPb-w522eUPwqFQa-HA1jtunnlwhI4/edit?usp=sharing' },
  { category: '全部署', name: 'エラー一覧', url: 'https://docs.google.com/document/d/140p9DoXIrl-g3ARPueRCktRcM6wMtYe0umLsBl_KzJw/edit?usp=sharing' },
  { category: '全部署', name: 'テンプレ集', url: 'https://drive.google.com/file/d/10Y28qgc_Qy9EdoqUDx7wGJw1_G7zw_Qd/view?usp=sharing' },
  { category: '全部署', name: 'スロ天操作ガイド', url: 'https://drive.google.com/file/d/1fjtVuJ7sEKVQI8ZojDSniCv-i2L6fIC5/view?usp=sharing' },
  { category: '全部署', name: 'スロ天管理画面ガイド', url: 'https://drive.google.com/file/d/1dH_Y-cBVIRs1PpOlRc4hrvckWeO5qQzG/view?usp=sharing' },
  { category: '全部署', name: 'ポイント追加マニュアル', url: 'https://drive.google.com/file/d/1HmiZOhXS9BJIJebxOiLNGHH2VHp0qSiO/view?usp=sharing' },
  { category: '全部署', name: 'Lottoジャックポット', url: 'https://drive.google.com/file/d/1wuqU_JjlxRHZf6hsKXdPJDuyTJ7smkAN/view?usp=sharing' },
  { category: '全部署', name: 'DISCORD', url: 'https://discord.gg/7hrDaJfw' },
  { category: '全部署', name: 'LINE', url: 'https://lin.ee/jTDURj3' },
  { category: '全部署', name: 'TELEGRAM', url: 'https://t.me/slotheavenbot' },
  { category: '全部署', name: 'ライセンス', url: 'https://drive.google.com/file/d/1kzH1VXOoUiMXTPhhxF_uTWIjACeEMNBE/view?usp=sharing' },
  { category: '全部署', name: 'ドリームポット説明', url: 'https://lottojackpot-jkhjm2sm.manus.space' },
  { category: 'AFF', name: 'Affiliate業務内容', url: 'https://drive.google.com/file/d/1MD17WZ-1_3FPfbSda8ZazXFoHPDBWs5q/view?usp=sharing' },
  { category: 'AFF', name: 'AFF部門', url: 'https://docs.google.com/spreadsheets/d/1GLaqQEoqEJZSRUUkYHiPKMhPXG7X7gwRmpoCe14FTQ8/edit?usp=sharing' },
  { category: 'AFF', name: 'AFF管理シート使用方法', url: 'https://drive.google.com/file/d/1ggZL19MNxwF6C3C3uFzocOXiDxIv1OLu/view?usp=sharing' },
  { category: 'AFF', name: 'アフィリエイト管理画面ガイド', url: 'https://drive.google.com/file/d/1cakCLShY7zL7htExWaTtYsWTvXtQ3cbO/view?usp=sharing' },
  { category: 'AFF', name: '交渉メッセージ例', url: 'https://docs.google.com/document/d/1wDR8F_PS6d1uOexvzy32z-mGK2R1LvSQlKvjwN2Lbqg/edit?usp=sharing' },
  { category: 'AFF', name: '想定Q&A', url: 'https://docs.google.com/document/d/17p1U1gxVsVXPyluIi6Df5yXHRPCAlULtfbHMA0sl7Dc/edit?usp=sharing' },
  { category: 'AFF', name: '法改正稼働AFF', url: 'https://docs.google.com/document/d/1PUDz6gnhQy1JY8wetz6-o7ID1l6teTlX2Up4AmoJ3GY/edit?usp=sharing' },
  { category: 'AFF', name: 'アフィリエイト交渉マニュアル', url: 'https://drive.google.com/file/d/1Yd45I7jsBpi0z0w64DgEObVBsgwyyjaO/view?usp=sharing' },
  { category: 'AFF', name: 'アフィリエイト一覧', url: 'https://docs.google.com/spreadsheets/d/1RpzwRIDj9kdLA9IgiDyJp2FglPfFjonsehacHzhZA_Q/edit?usp=sharing' },
  { category: 'AFF', name: 'アフィリエイト管理シート', url: 'https://docs.google.com/spreadsheets/d/1n_LugVAUAW3wwGvkXXNwl4W4u54Pb527wm_1q4ptZu8/edit?usp=sharing' },
  { category: 'AFF', name: '特別報酬の場合', url: 'https://drive.google.com/file/d/1w_ymENbPhoiOjb7hie7OoBR0wN9w-MPJ/view?usp=sharing' },
  { category: 'AFF', name: 'アフィリエイト制度', url: 'https://drive.google.com/file/d/1vwrDJil97_49XN5KgMVnEhyysxtCkj_7/view?usp=sharing' },
  { category: 'AFF', name: 'アフィリエイター向け営業資料', url: 'https://drive.google.com/file/d/100M986dhIQlDBUu2b9ddtzgC-Oay0BMN/view?usp=sharing' },
  { category: 'AFF', name: 'アフィリエイト管理画面', url: 'https://asp.sloten.io/login?redirect=/home' },
  { category: 'AFF', name: 'AFFトークスクリプト', url: 'https://drive.google.com/file/d/18GITRPM_x3BiTQv8KL0v6RsmWvEIZKZ5/view?usp=sharing' },
  { category: 'AFF', name: '競馬インフルエンサーリスト', url: 'https://docs.google.com/spreadsheets/d/1glOO7LnOfonaRDXqbjQp0olXBx4OCwm1w9oWJk1-mIE/edit?usp=sharing' },
  { category: 'AFF', name: '競艇インフルエンサーリスト', url: 'https://docs.google.com/spreadsheets/d/10n6lRdEQgjz-szgeqYiIAEbDKHWExG2wVsmv6ca6suk/edit?usp=sharing' },
  { category: 'AFF', name: 'ポーカーインフルエンサー', url: 'https://docs.google.com/spreadsheets/d/1n51wmJVayjYot1MSW5cBSDSDCnT2NiDZfFMOkb1PQoQ/edit?usp=sharing' },
  { category: 'AFF', name: '宝くじインフルエンサーリスト', url: 'https://docs.google.com/spreadsheets/d/1sVrc6Yhsu9qOF-CiMxM48r1jVxbKQFl08oxRWGtUcmg/edit?usp=sharing' },
  { category: 'AFF', name: 'パチンコインフルエンサーリスト', url: 'https://docs.google.com/spreadsheets/d/17YCTAGla5a2daKbqm48k7Tr7PZq0ols8yhr38m78V-Y/edit?usp=sharing' },
  { category: 'AFF', name: '麻雀インフルエンサー', url: 'https://docs.google.com/spreadsheets/d/17qJkfdSvBnuQ1ym-AOACHZc2ZcsbAUAJHD9zej9tlak/edit?usp=sharing' },
  { category: 'AFF', name: 'カジノインフルエンサー', url: 'https://docs.google.com/spreadsheets/d/1IS_kyOhRxbBryaKKys_2_wrQuZeH1rKfSdhtMoXXyFk/edit?usp=sharing' },
  { category: 'AFF', name: 'FXインフルエンサー', url: 'https://docs.google.com/spreadsheets/d/1k9ytUTFIu3S6yeyRMun-QnUN0kM5Ub_cnafyki5VCQo/edit?usp=sharing' },
  { category: 'AFF', name: 'バイナリーインフルエンサー', url: 'https://docs.google.com/spreadsheets/d/13NkpKKL1c9EommpLHz4s3Acq0ppGesw4JS1_gPe1gAc/edit?usp=sharing' },
  { category: 'AFF', name: '仮想通貨インフルエンサー', url: 'https://docs.google.com/spreadsheets/d/1BE5L25av_kK4m3Pbrfn3ELrfbsHHtn7Gt_niEpcM3Oc/edit?usp=sharing' },
  { category: 'AFF', name: 'アフィリエイトとは', url: 'https://drive.google.com/file/d/1sxRBdrnisb2nj9mbJ2VMTdai7OXra_SD/view?usp=sharing' },
  { category: 'AFF', name: 'ゲーミング未経験マニュアル①', url: 'https://drive.google.com/file/d/1drlObkpN75njpLE0Z-v5cQQ6WwtrvuL9/view?usp=sharing' },
  { category: 'AFF', name: 'ゲーミング未経験マニュアル②', url: 'https://drive.google.com/file/d/17rMfFcGpwGsjVLNL6Pj9kdituGOHzuZ0/view?usp=sharing' },
  { category: 'AFF', name: 'ゲーミング経験者マニュアル①', url: 'https://drive.google.com/file/d/1v5GEHQWKwgmsF89IAMR3PRfzQbXt9Cl4/view?usp=sharing' },
  { category: 'AFF', name: 'ゲーミング経験者マニュアル②', url: 'https://drive.google.com/file/d/10UJ7ZQplHSdl85_tsNwmWjD6SFKe4jrY/view?usp=sharing' },
  { category: 'AFF', name: '初心者用AFFマニュアル①', url: 'https://drive.google.com/file/d/1CMJn0pV8fJpNNwl1-rVhmOxJvIRYbHj9/view?usp=sharing' },
  { category: 'AFF', name: '初心者用AFFマニュアル②', url: 'https://drive.google.com/file/d/1EuNc7ikGlVhN1P56FtcPOampg0ZeTkTs/view?usp=sharing' },
  { category: 'AFF', name: '必達管理', url: 'https://docs.google.com/spreadsheets/d/1sX2tFlm-Fo4vML8HaisPqzLj3sIhYXBzJxHvTLzZxbU/edit?usp=sharing' },
  { category: 'AFF', name: 'DSCユーザーアフィリ誘導', url: 'https://docs.google.com/spreadsheets/d/1CRkRQrlqEOy0Wn4YPZNwaPHu9VYcEGg7I4CMrqNxGbo/edit?usp=sharing' },
  { category: 'CS', name: 'CS業務内容', url: 'https://drive.google.com/file/d/1yaJLp77zkMbuRSklo9c5nTsfJTv7pESC/view?usp=sharing' },
  { category: 'CS', name: 'CS部門', url: 'https://docs.google.com/spreadsheets/d/1lmjDjjwtQvykisZAqUD2OsI9zB_Xru8nTkGIPo5NSsY/edit?usp=sharing' },
  { category: 'CS', name: 'プレイヤーチェック管理使用方法', url: 'https://drive.google.com/file/d/1MPfM_gxH3QujbA2zJoXC_BvKiVYUjm3y/view?usp=sharing' },
  { category: 'CS', name: 'プレイヤーチェック管理', url: 'https://docs.google.com/spreadsheets/d/1CvFwZ3HDKjEUvzUjOH5xrKYGq2hwlWwAifxWWdUZRmk/edit?usp=sharing' },
  { category: 'CS', name: 'エラー事項記載シート', url: 'https://docs.google.com/spreadsheets/d/1vKFFoEYVw7z1C7bU3thgwf_U7scmVSuLpz_xGJPjWpc/edit?usp=sharing' },
  { category: 'CS', name: 'チャットウッド', url: 'https://im.slot-h.com/app/accounts/3/dashboard' },
  { category: 'VIP', name: 'VIP業務内容', url: 'https://drive.google.com/file/d/1ifRKr1I94k2YMjJ0x9rfoLOL4lkBxqnq/view?usp=sharing' },
  { category: 'VIP', name: 'VIP部門', url: 'https://docs.google.com/spreadsheets/d/1UdC202Mx0UP_qzIIJY3tI3DyI4OGAJg88o5C7GIklU0/edit?usp=sharing' },
  { category: 'VIP', name: 'アップセルトークスクリプト', url: 'https://drive.google.com/file/d/1alGFHvW-gO_1dCv9MeiFEYXZsYfzom1I/view?usp=sharing' },
  { category: 'VIP', name: '電話リスト', url: 'https://docs.google.com/spreadsheets/d/1TKIejq0QR2bywgZ67xsDQKjH5ZYqn3ijJZRzs4t2y9Y/edit?usp=sharing' },
  { category: 'VIP', name: 'VIPチェック管理', url: 'https://docs.google.com/spreadsheets/d/1cRDYJQKkPqdzJcSx7zeEy83XMS8pDgLQRcP---lzg-4/edit?usp=sharing' },
  { category: 'オペ', name: 'オペレーション業務内容', url: 'https://drive.google.com/file/d/161xgqNM94UIKiszi_kr-UGLtfE-9gnJM/view?usp=sharing' },
  { category: 'オペ', name: 'operation部門', url: 'https://docs.google.com/spreadsheets/d/1-Yov3AcStVcdVIPNh1OicwaYssdg0Ei6mR80qlmUgq4/edit?usp=sharing' },
  { category: 'オペ', name: 'KPI', url: 'https://docs.google.com/spreadsheets/d/1oGnetFNtGd1ZB-A9YkzzfqIU4Bxh3djsABeEX_bHl8M/edit?usp=sharing' },
  { category: 'オペ', name: 'LP①計測シート', url: 'https://docs.google.com/spreadsheets/d/18QiN_BoVS-hdP-e4vNOAzjDZaFLTtnWlogJ5AW1hQSY/edit?usp=sharing' },
  { category: 'オペ', name: 'トーナメント', url: 'https://docs.google.com/spreadsheets/d/1w2bVg5jhKNzkSPrOfdu2siWq1wwRRq3YZGZ5XdhZQBo/edit?usp=sharing' },
  { category: 'オペ', name: 'メルマガ', url: 'https://docs.google.com/spreadsheets/d/1B0VSScmblCgUszAxIKvFzdTRSUSqxTnzJSv7djSB5DQ/edit?usp=sharing' },
  { category: 'オペ', name: 'トーナメント企画提案', url: 'https://drive.google.com/file/d/12IG73qt6L8vE2YPdRLSNW418DXhAOTil/view?usp=sharing' },
  { category: 'オペ', name: 'SocialDog使用マニュアル', url: 'https://drive.google.com/file/d/1IrvtVSvbTeT7qc-UH1cR3D2TY2P0i5oe/view?usp=sharing' },
  { category: 'オペ', name: 'プロモ作成例', url: 'https://drive.google.com/file/d/1s17K-oe5mmz28O1S5Y_7RIF5S1NwT-AB/view?usp=sharing' },
  { category: 'オペ', name: 'メルマガシート使用方法', url: 'https://drive.google.com/file/d/1PJqbjZv125x6wzwZjRe01qZxc5NkY2nf/view?usp=sharing' },
  { category: 'オペ', name: 'トーナメントシート使用方法', url: 'https://drive.google.com/file/d/1VCWfMwo09oAHjw691R-hgLBJJSc2MSLf/view?usp=sharing' },
  { category: 'オペ', name: 'SMS計測シート', url: 'https://docs.google.com/spreadsheets/d/1_pMLIN8bHkaVUcAZS0PiQQiBCGpJmcWMeywDeIE-TLY/edit?usp=sharing' },
  { category: 'オペ', name: 'SMS-LP1計測方法①', url: 'https://drive.google.com/file/d/1vHabuP-EWFtGKhyAA5HvcUjcNpGMWcEV/view?usp=sharing' },
  { category: 'オペ', name: 'SMS-LP1計測方法②', url: 'https://drive.google.com/file/d/132mVbncdAtkabvag_1mVUjaGTMu2hi6G/view?usp=sharing' },
  { category: 'オペ', name: 'Laffic番号別送信方法', url: 'https://drive.google.com/file/d/1fEFLONFUt1AuL7aRrT_3f9_gMc2j0KP9/view?usp=sharing' },
  { category: 'オペ', name: 'LP管理シート', url: 'https://lp.diamond-secret.club/reports/secure/click_report_SLOTENTEST.php' },
  { category: 'オペ', name: 'X計測用', url: 'https://millionheaven.site/' },
  { category: 'オペ', name: 'TIKTOK計測シート', url: 'https://docs.google.com/spreadsheets/d/1RmVdM24EZKDhKem3htNazU_fod4JJXL-U2bCiJPJmgA/edit?usp=sharing' },
  { category: 'オペ', name: 'TIKTOK計測用', url: 'https://millionheaven.space/' },
  { category: 'オペ', name: 'FBアカウント一覧', url: 'https://docs.google.com/spreadsheets/d/1GsPqdAcd2TjRKj4GPk6QzziLsM9IHg4K/edit?usp=sharing' },
  { category: 'オペ', name: 'メーラー', url: 'https://fviainboxes.com/' },
  { category: 'ペイメント', name: 'ペイメント業務内容', url: 'https://drive.google.com/file/d/1crHJAlc8zfV-x9jJFoxnDkZ45L0EFEq4/view?usp=sharing' },
  { category: 'ペイメント', name: 'Payment部門', url: 'https://docs.google.com/spreadsheets/d/1lBgXBn2GrDejUGd_p_SZJzFXIRRUosApgyJv-ns9PVY/edit?usp=sharing' },
  { category: 'ペイメント', name: 'リスク管理シート', url: 'https://docs.google.com/spreadsheets/d/1XuWNCPtObuebJ1zaPH5TisZzUh8Ro8r0mu1FTcX74is/edit?usp=sharing' },
  { category: 'ペイメント', name: 'BIGシート使用方法', url: 'https://drive.google.com/file/d/1DD5-OpdLXkW_-RM_eeX_oX-1HtWHy2_n/view?usp=sharing' },
  { category: 'ペイメント', name: 'PayPayマニュアル', url: 'https://drive.google.com/file/d/1oU-KV0fJDZrxxee-4Bp7Xh8kstX6Eh83/view?usp=sharing' },
  { category: 'ペイメント', name: 'OKJへの振込手順', url: 'https://drive.google.com/file/d/1dQd_4fR7xczNgZQAARcrh1_UMUKDjqZ6/view?usp=sharing' },
  { category: 'ペイメント', name: 'セトルルール', url: 'https://drive.google.com/file/d/1utkzLJharn-H7AKGv-4kG_hPEeK_x2zC/view?usp=sharing' },
  { category: 'ペイメント', name: '入金フロー', url: 'https://drive.google.com/file/d/1S2lkhPgb2CkafeCmisHzmczvYvpDiyEt/view?usp=sharing' },
  { category: 'ペイメント', name: 'EC発行方法', url: 'https://drive.google.com/file/d/1UYb9OgxGPKSBC-EbVrj7ECJD4H74R3en/view?usp=sharing' },
  { category: 'ペイメント', name: 'ポイントBO', url: 'https://add.sloten.io/' },
  { category: 'ペイメント', name: 'EC着金確認', url: 'https://docs.google.com/spreadsheets/d/18KCWtE3_wFStjIE8RYlK47XaeAi3TRwGpvugBwSe3Qk/edit?usp=sharing' },
  { category: 'ペイメント', name: 'PayPay着金確認', url: 'https://docs.google.com/spreadsheets/d/1a-qM_--jYMaeYgurhRkZRiJH4r9INsrokjTzlzmhSds/edit?usp=sharing' },
  { category: 'ペイメント', name: '銀行着金確認', url: 'https://docs.google.com/spreadsheets/d/1daNRR0EOVns0surDpfeng5CQ4PMNJ7j7kQ12jiRJkw8/edit?usp=sharing' },
  { category: 'ペイメント', name: '入出金', url: 'https://drive.google.com/file/d/1UxWGSvb05zWFZ-hkoPTwk-vCd7c_eS6H/view?usp=sharing' },
  { category: 'ペイメント', name: 'ペイメントコスト', url: 'https://docs.google.com/spreadsheets/d/1wcSLMZ-Yrk3sMN2b1I7hOfUpyGveB7YjeK4o34UkFUE/edit?usp=sharing' },
  { category: 'ペイメント', name: 'ペイメントフィー', url: 'https://docs.google.com/spreadsheets/d/1KjTPZUD5ymtu9RyBMdpVOmHCh1YONfJ1ZnyVoFd_Tnw/edit?usp=sharing' },
  { category: 'ペイメント', name: 'ロジック', url: 'https://docs.google.com/spreadsheets/d/1bzncOP78MQz60lIzD-jamDraTXcdDNFfsrG-MZ5Adzw/edit?usp=sharing' },
  { category: 'ペイメント', name: '入出金集計BO', url: 'https://docs.google.com/spreadsheets/d/1jmEs_orPFe7y5YPnj7_bFT1JHiIs-cCFOptQsNOCqsM/edit?usp=sharing' },
  { category: 'admin', name: 'スロ天ガチャ', url: 'https://lp.diamond-secret.club/Slotengacha/' },
  { category: 'admin', name: 'スロ天ルーレット', url: 'https://lp.diamond-secret.club/Slotenroulet/' },
  { category: 'admin', name: 'イメージ図', url: 'https://drive.google.com/file/d/1dKcSH4B4rhnKKaeGhQvGHGEULyqTqDWO/view?usp=sharing' },
  { category: 'admin', name: 'VIPテーブル', url: 'https://drive.google.com/file/d/1QyHwFTfKKnUnxPIbBuHz6eEfnqo2a_Je/view?usp=sharing' },
  { category: 'admin', name: 'アフィリエイトテーブル', url: 'https://drive.google.com/file/d/1osC-bnA6eEEEDj4ly2OqCuzzhRKc8ZT5/view?usp=sharing' },
  { category: 'admin', name: '一般規約', url: 'https://docs.google.com/document/d/1cnTxy0_CHQeTG3mh4uIdJ7P7vi7KFhrBMmPnb6uhMiw/edit?usp=sharing' },
  { category: 'admin', name: 'プロモ規約', url: 'https://docs.google.com/document/d/1ULv_r5fZ3VHVHmgCJcA_dyqxUEm5YIGOL6IEXCBuVL8/edit?usp=sharing' },
  { category: 'admin', name: 'プライバシーポリシー', url: 'https://docs.google.com/document/d/1bhfg4pukcWqb6xm0WlxZXwjY9_4Prl_EbRMKbRp-gmo/edit?tab=t.0' },
  { category: 'admin', name: '責任あるゲーミング', url: 'https://docs.google.com/document/d/1O8jjHNbPe0sjLFzbE_HRol3zA9L4ZhEU3OtxmLod6Rg/edit?tab=t.0' },
  { category: 'admin', name: 'SNS運用資料', url: 'https://docs.google.com/presentation/d/1JAZ2xWanHCd_oyCEvth8WPVA0FwJbCKsBEQumXngQg0/edit?usp=sharing' },
  { category: 'admin', name: '公式SNS投稿スケジュール', url: 'https://docs.google.com/spreadsheets/d/1FHYqOfah4QAELcteQ5D_uh7eaNOxShrs7Uw9FFC22rU/edit?usp=sharing' },
  { category: 'admin', name: 'SNS管理シート', url: 'https://docs.google.com/spreadsheets/d/1ZSt9uOrxnFWF23BofcYyj4DbS9e78s82iRhTSvodaTs/edit?usp=sharing' },
  { category: 'admin', name: 'ボーナス期待値計算ツール', url: 'https://docs.google.com/spreadsheets/d/1cD0oANxtYC4L0FCyel28RghP4yJVmCeMGJC-NP0FxG8/edit?usp=sharing' },
  { category: 'admin', name: 'QAシート', url: 'https://docs.google.com/spreadsheets/d/1TCSDgHmxz6LTs4YDsu4pab0NZxd9vDR7T5q8bX3CJ-c/edit?usp=sharing' },
  { category: 'admin', name: 'DRIVE', url: 'https://drive.google.com/drive/folders/1rrIyglyY-NpFUH7af8abapHrJOvojKdg?usp=sharing' },
  { category: 'admin', name: '他社報酬調査結果', url: 'https://drive.google.com/file/d/1bT3HsAMFEL1SDiRb1PsYHslzOxJTVQgF/view?usp=sharing' },
  { category: 'admin', name: '他社リベート調査結果', url: 'https://docs.google.com/spreadsheets/d/1VwJU_ANdf6VFKUWTA-4CCFDPRF-hFDJLMX_q8BwOiss/edit?usp=sharing' },
  { category: 'admin', name: 'PSP比較', url: 'https://docs.google.com/spreadsheets/d/14-ucTxEzFpoe-UTfwd81_-jfnkvAzGurSiEv6bF8UFQ/edit?usp=sharing' },
  { category: 'admin', name: 'チャットBOT内容', url: 'https://drive.google.com/file/d/1FGMBiKX048v58Kap9dC3CBGsmPsLPe_F/view?usp=sharing' },
  { category: 'admin', name: 'プロバイダーデータ項目', url: 'https://docs.google.com/spreadsheets/d/144u3L0r04508lcfe8quuIr_3oxQ8e5pHxlx2T-HsO4M/edit?usp=sharing' },
  { category: 'admin', name: 'スロ天LP①計測', url: 'https://lp.diamond-secret.club/SLOTENTEST/' },
  { category: 'admin', name: 'ドリームポットLP', url: 'https://lp.diamond-secret.club/slotentakarakuji/' },
  { category: 'admin', name: 'ドリームポットマイページ', url: 'https://lp.diamond-secret.club/takarakuzimypage/' },
  { category: 'admin', name: 'コール入力システム', url: 'https://script.google.com/macros/s/AKfycbzi6_9-f5aIk1pKxwsQvH-CZ26wLs7GEruchrCIppiiXxRzIwRmgTIcGgSE0PctoksO/exec' },
  { category: 'admin', name: 'コールシステムadmin', url: 'https://script.google.com/macros/s/AKfycbzi6_9-f5aIk1pKxwsQvH-CZ26wLs7GEruchrCIppiiXxRzIwRmgTIcGgSE0PctoksO/exec?page=admin' },
  { category: 'admin', name: '経費', url: 'https://docs.google.com/spreadsheets/d/1c0eaV1gVAQTYLgVAC5uhkJ3xfxaJelVPMUeyj6-9qgc/edit?usp=sharing' },
  { category: 'admin', name: '人件費', url: 'https://docs.google.com/spreadsheets/d/1xllLaq4MBwL74KokaeWHMcnkFPzPJ_y-81gCaSvWlVU/edit?usp=sharing' },
  { category: 'admin', name: 'テレグラムリッチメニュー装填用', url: 'https://docs.google.com/spreadsheets/d/1-luSPr0s5mb35FwyZQ-ZrbcCdxFxVVAF-sTfOHC9ICs/edit?usp=sharing' },
  { category: 'admin', name: 'ボーナス期待値計算ツール(複製用)', url: 'https://docs.google.com/spreadsheets/d/1UCdTWGiBjo_ZTYRY1JL_DgyJ0ujuJZO4hFWddREf7UM/edit?usp=sharing' },
  { category: 'admin', name: 'よくある質問', url: 'https://docs.google.com/spreadsheets/d/1l06gFHmsluPkKBJ6DLj3h5qOmjMoStD_gbHXar2aBZk/edit?usp=sharing' },
  { category: 'admin', name: '宝くじシステム概要', url: 'https://drive.google.com/file/d/1TCAFxvV2w32vhmBlKv08zCHTjPQD2DMt/view?usp=sharing' },
  { category: 'admin', name: '他社アフィリエイト報酬形態', url: 'https://docs.google.com/spreadsheets/d/1W3_L4U5y8bt6IPe6GZ8nTSJVh_lWe-kJ_LTUXIbckTI/edit?usp=sharing' },
  { category: 'admin', name: 'カスタマージャーニー', url: 'https://docs.google.com/spreadsheets/d/16a3Z1PEwhHQ4N3t4b4RLtK19bV9ae_egOwBBteCTq_8/edit?usp=sharing' },
  { category: 'admin', name: 'テレグラ要約BOT①', url: 'https://docs.google.com/spreadsheets/d/1-Wg3NeLWhqPBhWE7FlMYDcsVfY4ZDZ5DYl9FqQgDPgU/edit?usp=sharing' },
  { category: 'admin', name: 'テレグラ要約BOT②', url: 'https://docs.google.com/spreadsheets/d/1XpTbyuEPVdFy3SFGqJnC97iHlMnANqbdLjZrEPpFsyU/edit?usp=sharing' },
  { category: 'その他', name: 'AFF管理画面', url: 'https://casino-affiliate-pulse.lovable.app/' },
  { category: 'その他', name: 'LP管理', url: 'https://docs.google.com/spreadsheets/d/1yLbPPOr85l5x15CoIPTWMbFQqQV0CQjdeoi1dSauX6U/edit?usp=sharing' },
  { category: 'その他', name: 'タスクまとめ', url: 'https://docs.google.com/spreadsheets/d/1ZNo_1jd6EYX6O1cccQ9sa3A2xJwInIMU5QinvOUvk2E/edit?usp=sharing' },
  { category: 'その他', name: 'CLOUD', url: 'https://panel.cloudzy.com/dashboard' },
  { category: 'その他', name: 'ダッシュボード', url: 'https://sloten-dashboard.manus.space/' },
  { category: 'その他', name: 'リンク集', url: 'https://sloten-link.manus.space' },
  { category: 'その他', name: 'メルマガ②', url: 'https://docs.google.com/spreadsheets/d/1-_GzRGpqZqm-lmI32XBA9yhhr4bGm5H0eN04PzRxg-0/edit?usp=sharing' },
  { category: 'その他', name: 'ヘブンズショット', url: 'https://docs.google.com/spreadsheets/d/1j8-qutGdAON0W0Fn4KIiQdt4HiXmkudMNGQ21Ba0ZMw/edit?gid=0' },
  { category: 'その他', name: 'SMS送信', url: 'https://docs.google.com/spreadsheets/d/1dZo7cQL1pM1Z2sU8P5qoYIvsyBs0PS16lnKPxtDJ3yE/edit?usp=sharing' },
  { category: 'その他', name: 'SMS送信本屋', url: 'https://docs.google.com/spreadsheets/d/1yTu17jNIgIGEbgJK639mrbH_lgBWA79vUSfNdACK_dM/edit?usp=sharing' },
  { category: 'その他', name: 'バカラチャレンジ', url: 'https://docs.google.com/spreadsheets/d/1qGd0hneNNqNNZCNMXbO89wYusHIbB0nnNqZNvjsqnbY/edit?usp=sharing' },
  { category: 'その他', name: 'みんなの時間割', url: 'https://docs.google.com/spreadsheets/d/1Qh4xxb6pIXP1TMdRY24zcJcjDts-2MFgXcTYfKjHNg8/edit?usp=sharing' },
  { category: 'その他', name: '無料ゲームサイト', url: 'https://docs.google.com/spreadsheets/d/14nWspAUsHzmCewIySecFwxAROP2xpy56zoVChBRJNYw/edit?usp=sharing' },
  { category: 'その他', name: '設置状況', url: 'https://docs.google.com/spreadsheets/d/1_Wfe1tqWIyuLWYZ73QQPMYeDL8FInQTWCAvsn0ptogA/edit?usp=sharing' },
  { category: 'その他', name: 'SMS分析', url: 'https://docs.google.com/spreadsheets/d/1Z-fVjbHWAUXLgajlDba1Pm1fU6Ble52ddbVLBcxFEcU/edit?usp=sharing' },
  { category: 'その他', name: 'SMSデータ', url: 'https://docs.google.com/spreadsheets/d/1o58Zmm6dhcFbLRfLZajLjsWbeE57DOQqY5ncH1FunUs/edit?usp=sharing' },
  { category: 'その他', name: '連勝王連敗王', url: 'https://docs.google.com/spreadsheets/d/1tmBj1U_pclbuIFk1lQz8cSTAH0aPOPW9G92j4Mo5tq8/edit?usp=sharing' },
  { category: 'その他', name: 'DC/ACE', url: 'https://share.dc-ace.com/login?redirect=/folder/DC%2520Lobby/Promo%2520Package/' },
  { category: 'その他', name: 'ボーナスコード管理', url: 'https://docs.google.com/spreadsheets/d/1c58Oz88Y-8Yg8Xz4yqQYk8KgFIjufZefbC94krz3dwo/edit?usp=sharing' },
  { category: 'その他', name: 'CSVセグメントツール', url: 'https://crm-segmentation-tool-gnwlkpueqvcdgapck3uv8z.streamlit.app/' },
  { category: 'その他', name: 'カレンダー', url: 'https://shared-calendar-app-iota.vercel.app/' },
  { category: 'その他', name: 'SEOツール', url: 'https://nexus-seo-u5uq936q.manus.space/' },
  { category: 'その他', name: 'スロ天CSVデータ', url: 'https://userdash-eanx4o83.manus.space/?code=C9CEZYMehvBKv3HUVMoNGw' },
  { category: 'その他', name: '世界の大会', url: 'https://gamblingtourn-abc2g3fa.manus.space/' },
];

const BUSINESSES = {
  '元amuse': { data: MOTO_AMUSE_DATA, type: 'samExcel' },
  'DSC': { data: DSC_DATA, type: 'samExcel' },
  'スロ天': { data: SLOTEN_DATA, type: 'sloten' },
  '広告': { data: {}, type: 'ads' },
  'バカラツール': { data: {}, type: 'baccara' },
  'AMUSEVIP': { data: {}, type: 'agent' }
};

let currentBusiness = '元amuse';
let currentPeriod = null;
let chartInstance = null;

// ========== ユーティリティ ==========
function parseNumber(val) {
  if (val === undefined || val === null || val === '' || val === '-' || val === '#DIV/0!' || val === '#REF!') return null;
  if (typeof val === 'number') return val;
  let cleaned = String(val).replace(/[¥￥$,、"\s]/g, '').trim();
  if (cleaned.endsWith('%')) cleaned = cleaned.replace(/%$/, '');
  const num = parseFloat(cleaned);
  return isNaN(num) ? null : num;
}

function formatCurrency(val) {
  if (val == null || isNaN(val)) return '-';
  const abs = Math.abs(val);
  const sign = val < 0 ? '-' : '';
  if (abs >= 100000000) return sign + '¥' + (abs / 100000000).toFixed(2) + '億';
  if (abs >= 10000) return sign + '¥' + Math.round(abs / 10000).toLocaleString() + '万';
  return sign + '¥' + Math.round(abs).toLocaleString();
}

function formatPercent(val) {
  if (val == null || isNaN(val)) return '-';
  const v = Math.abs(val) <= 1 ? val * 100 : val;
  return v.toFixed(2) + '%';
}

function formatNumber(val) {
  if (val == null || isNaN(val)) return '-';
  return Math.round(val).toLocaleString();
}

function sortPeriods(periods) {
  return [...periods].sort((a, b) => {
    const mA = a.match(/(\d{4})年(\d{1,2})月/);
    const mB = b.match(/(\d{4})年(\d{1,2})月/);
    if (mA && mB) {
      const yA = parseInt(mA[1]), monA = parseInt(mA[2]);
      const yB = parseInt(mB[1]), monB = parseInt(mB[2]);
      return (yB * 12 + monB) - (yA * 12 + monA);
    }
    return b.localeCompare(a);
  });
}

// ========== 初期化 ==========
document.addEventListener('DOMContentLoaded', () => {
  renderTabs();
  selectBusiness('元amuse');
  setupDragDrop();
});

function renderTabs() {
  const container = document.getElementById('business-tabs');
  container.innerHTML = Object.keys(BUSINESSES).map(name => 
    `<button class="tab ${name === currentBusiness ? 'active' : ''}" onclick="selectBusiness('${name}')">${name}</button>`
  ).join('') + '<button class="btn btn-danger" onclick="deleteBusiness()" style="margin-left:auto">🗑️</button>';
}

function selectBusiness(name) {
  currentBusiness = name;
  const business = BUSINESSES[name];
  const data = business?.data || {};
  const periods = sortPeriods(Object.keys(data));
  currentPeriod = periods[0] || null;
  renderTabs();
  renderPeriodSelector(periods);
  renderSummary();
  renderKPISections();
  renderChart();
  renderLinks();
  renderTable();
}

function renderPeriodSelector(periods) {
  const container = document.getElementById('period-selector');
  if (periods.length === 0) {
    container.innerHTML = '<span style="color:#94a3b8;font-size:13px">データをアップロードしてください</span>';
    return;
  }
  container.innerHTML = periods.map(p => 
    `<button class="period-btn ${p === currentPeriod ? 'active' : ''}" onclick="selectPeriod('${p}')">${p}</button>`
  ).join('') + `<button class="btn btn-danger" style="padding:4px 10px;font-size:11px" onclick="deletePeriod()">期間削除</button>`;
}

function selectPeriod(period) {
  currentPeriod = period;
  const periods = sortPeriods(Object.keys(BUSINESSES[currentBusiness]?.data || {}));
  renderPeriodSelector(periods);
  renderSummary();
  renderKPISections();
  renderTable();
}

function deletePeriod() {
  const business = BUSINESSES[currentBusiness];
  const periods = Object.keys(business?.data || {});
  if (periods.length <= 1) { alert('最後の期間は削除できません'); return; }
  if (confirm(`「${currentPeriod}」を削除しますか？`)) {
    delete business.data[currentPeriod];
    selectBusiness(currentBusiness);
  }
}

// ========== サマリー ==========
function renderSummary() {
  const container = document.getElementById('summary-section');
  const business = BUSINESSES[currentBusiness];
  const periodData = business?.data?.[currentPeriod];
  const data = periodData?.サマリー || periodData || {};
  
  if (!data || Object.keys(data).length === 0) {
    container.innerHTML = '<div class="card" style="text-align:center;padding:40px;color:#94a3b8">データがありません</div>';
    return;
  }
  
  const type = business.type;
  const colors = ['linear-gradient(135deg,#3b82f6,#1d4ed8)','linear-gradient(135deg,#10b981,#059669)','linear-gradient(135deg,#f59e0b,#d97706)','linear-gradient(135deg,#ef4444,#dc2626)','linear-gradient(135deg,#8b5cf6,#7c3aed)','linear-gradient(135deg,#ec4899,#db2777)','linear-gradient(135deg,#06b6d4,#0891b2)','linear-gradient(135deg,#84cc16,#65a30d)'];
  
  let cards = [];
  if (type === 'samExcel') {
    cards = [
      { key: 'T/O', label: 'T/O' },
      { key: 'GGR(WIN/LOSE)', alt: ['GGR','WIN/LOSE'], label: 'GGR' },
      { key: 'NGR', label: 'NGR' },
      { key: '回収率(全体)', alt: ['回収率'], label: '回収率', format: 'percent' },
      { key: 'GGR(回収金額-出金金額)', label: '入出金差分' },
      { key: '利益', label: '利益' }
    ];
  } else if (type === 'sloten') {
    cards = [
      { key: 'GGR', label: 'GGR' },
      { key: '総入金額', label: '総入金額' },
      { key: '総出金額', label: '総出金額' },
      { key: '入出金差分', label: '入出金差分' },
      { key: 'RTP', label: 'RTP', format: 'percent' },
      { key: '登録人数', label: '登録人数', format: 'number' }
    ];
  } else if (type === 'ads') {
    cards = [
      { key: 'コスト(円)', label: 'コスト', format: 'currency' },
      { key: 'インプレッション合計', alt: ['インプレッション'], label: 'IMP', format: 'number' },
      { key: 'クリック合計', alt: ['クリック'], label: 'クリック', format: 'number' },
      { key: 'CTR', label: 'CTR', format: 'percent' },
      { key: '登録合計', alt: ['登録数'], label: '登録', format: 'number' },
      { key: '入金合計', alt: ['入金数'], label: '入金', format: 'number' },
      { key: 'CVR', label: 'CVR', format: 'percent' },
      { key: 'CPA(円)', label: 'CPA', format: 'currency' }
    ];
  } else if (type === 'agent') {
    cards = [
      { key: '入金合計', label: '入金合計' },
      { key: '出金合計', label: '出金合計' },
      { key: '収益合計', label: '収益合計' },
      { key: 'ローリング報酬', label: 'ローリング報酬' },
      { key: 'NGR', label: 'NGR' },
      { key: 'T/O合計', label: 'T/O合計' }
    ];
  } else if (type === 'baccara') {
    cards = [
      { key: '登録数', label: '登録数', format: 'number' },
      { key: '合計流入', label: '合計流入', format: 'number' },
      { key: '総ユーザー数', label: '総ユーザー', format: 'number' },
      { key: '総入金額', label: '総入金額' },
      { key: '総GGR', label: '総GGR' },
      { key: 'コスト', label: 'コスト' },
      { key: 'NGR', label: 'NGR' }
    ];
  }
  
  container.innerHTML = '<div class="summary-grid">' + cards.map((card, i) => {
    let val = data[card.key];
    if (val == null && card.alt) {
      for (const k of card.alt) { if (data[k] != null) { val = data[k]; break; } }
    }
    if (val == null) return '';
    let formatted;
    if (card.format === 'percent') formatted = formatPercent(val);
    else if (card.format === 'number') formatted = formatNumber(val);
    else if (card.format === 'usd') formatted = '$' + (val || 0).toFixed(2);
    else if (card.format === 'currency') formatted = formatCurrency(val);
    else formatted = formatCurrency(val);
    const bg = val < 0 && card.format !== 'percent' ? 'linear-gradient(135deg,#ef4444,#dc2626)' : colors[i % colors.length];
    return `<div class="summary-card" style="background:${bg}"><h3>${card.label}</h3><div class="value">${formatted}</div></div>`;
  }).join('') + '</div>';
}

// ========== KPIセクション ==========
function renderKPISections() {
  const container = document.getElementById('kpi-sections');
  const business = BUSINESSES[currentBusiness];
  const periodData = business?.data?.[currentPeriod];
  const data = periodData?.サマリー || periodData || {};
  
  if (!data || Object.keys(data).length === 0) { container.innerHTML = ''; return; }
  
  const type = business.type;
  if (type === 'agent' || type === 'ads' || type === 'baccara') { container.innerHTML = ''; return; }
  
  const sections = [
    { title: '📞 営業KPI', keys: ['リスト件数','登録人数','打電数','着電数','LINE登録数','アカウント作成数','ログインユーザー数'], bg: '#dbeafe' },
    { title: '🎯 転換KPI', keys: ['FTP数','FTP率','FTD数','FTD率','FTW数','FTW率','FTDW数','FTDW率','FTDのみ入金者数','今月登録のFTD以降ユーザー数','今月登録FTD以降ユーザー割合'], bg: '#dcfce7' },
    { title: '🔄 継続KPI', keys: ['前月リテンション数','引継ぎプレイヤー数','アクティブユーザー数','アクティブプレイ人数（ユニーク）','アクティブプレイ人数','今月登録のアクティブユーザー数','前月登録のアクティブユーザー数'], bg: '#fef3c7' },
    { title: '💰 収益KPI', keys: ['T/O','T/O(リアルのみ)','勝利金','勝利金(リアルのみ)','RTP','GGR(WIN/LOSE)','GGR','WIN/LOSE','LTV(WIN/LOSE)','GGRLTV'], bg: '#e0e7ff' },
    { title: '💵 回収KPI', keys: ['回収予定金額','回収金額','回収率(全体)','回収率(今月)','出金金額','GGR(回収金額-出金金額)','LTV(GGR)','NGR','総入金額','総出金額','入出金差分'], bg: '#fce7f3' },
    { title: '💸 経費KPI', keys: ['合計経費','プロバイダーフィー','人件費','通信費','インセンティブ','ペイメントフィー','雑費・福利厚生等','BK','利益'], bg: '#ccfbf1' },
    { title: '📋 顧客リスト集計', keys: ['総登録数','総回収額','総出金額','回収出金差分','総差分利益','総NGR','総TO','総信用枠','総ボーナス','平均信用枠','平均NGR','担当者数','担当者計_登録数','担当者計_FTD数','担当者計_GGR','担当者計_NGR'], bg: '#fef3c7' },
    { title: '📊 未回収・ボーナス', keys: ['未回収者数','残未回収金額','遅れ回収者数','遅れ回収金額','ボーナス対象者数','総ボーナス付与金額','ボーナス対象入金額','ボーナス対象NGR'], bg: '#fee2e2' }
  ];
  
  const percentKeys = ['FTP率','FTD率','FTW率','FTDW率','RTP','回収率(全体)','回収率(今月)','今月登録FTD以降ユーザー割合'];
  const currencyKeys = ['T/O','T/O(リアルのみ)','勝利金','勝利金(リアルのみ)','GGR(WIN/LOSE)','GGR','WIN/LOSE','LTV(WIN/LOSE)','回収予定金額','回収金額','出金金額','GGR(回収金額-出金金額)','LTV(GGR)','NGR','合計経費','プロバイダーフィー','人件費','通信費','インセンティブ','ペイメントフィー','雑費・福利厚生等','BK','利益','総入金額','総出金額','入出金差分','GGRLTV','総回収額','回収出金差分','総差分利益','総NGR','総TO','総信用枠','総ボーナス','平均信用枠','平均NGR','担当者計_GGR','担当者計_NGR','残未回収金額','遅れ回収金額','総ボーナス付与金額','ボーナス対象入金額','ボーナス対象NGR'];
  
  container.innerHTML = sections.map(section => {
    const items = section.keys.filter(k => data[k] != null);
    if (items.length === 0) return '';
    return `<div class="card" style="background:${section.bg}"><div class="section-title">${section.title}</div><div class="kpi-grid">${items.map(key => {
      const val = data[key];
      let formatted;
      if (percentKeys.includes(key)) formatted = formatPercent(val);
      else if (currencyKeys.includes(key)) formatted = formatCurrency(val);
      else formatted = formatNumber(val);
      const isNeg = typeof val === 'number' && val < 0;
      return `<div class="kpi-item"><div class="label">${key}</div><div class="val ${isNeg ? 'negative' : ''}">${formatted}</div></div>`;
    }).join('')}</div></div>`;
  }).join('');
  
  // 入金/出金方法、ゲーム別、Affiliateの表示
  if (periodData?.入金方法) {
    const dep = periodData.入金方法;
    container.innerHTML += `<div class="card" style="background:#e0f2fe"><div class="section-title">💳 入金方法</div><div class="kpi-grid">${Object.entries(dep).map(([k,v]) => `<div class="kpi-item"><div class="label">${k}</div><div class="val">${formatCurrency(v)}</div></div>`).join('')}</div></div>`;
  }
  if (periodData?.出金方法) {
    const wd = periodData.出金方法;
    container.innerHTML += `<div class="card" style="background:#fef9c3"><div class="section-title">🏦 出金方法</div><div class="kpi-grid">${Object.entries(wd).map(([k,v]) => `<div class="kpi-item"><div class="label">${k}</div><div class="val">${formatCurrency(v)}</div></div>`).join('')}</div></div>`;
  }
  if (periodData?.ゲーム別) {
    const games = periodData.ゲーム別;
    container.innerHTML += `<div class="card" style="background:#f3e8ff"><div class="section-title">🎮 ゲーム別</div><div class="table-container"><table><thead><tr><th>ゲーム</th><th class="text-right">ユーザー数</th><th class="text-right">T/O</th><th class="text-right">GGR</th></tr></thead><tbody>${Object.entries(games).map(([name,g]) => `<tr><td>${name}</td><td class="text-right">${formatNumber(g.ユーザー数)}</td><td class="text-right">${formatCurrency(g.TO)}</td><td class="text-right">${formatCurrency(g.GGR)}</td></tr>`).join('')}</tbody></table></div></div>`;
  }
  if (periodData?.Affiliate) {
    const aff = periodData.Affiliate;
    container.innerHTML += `<div class="card" style="background:#ecfdf5"><div class="section-title">🤝 Affiliate</div><div class="kpi-grid">${Object.entries(aff).map(([k,v]) => `<div class="kpi-item"><div class="label">${k}</div><div class="val">${k.includes('率') ? formatPercent(v) : k.includes('数') ? formatNumber(v) : formatCurrency(v)}</div></div>`).join('')}</div></div>`;
  }
  // 担当者別データの表示
  if (periodData?.担当者別 && periodData.担当者別.length > 0) {
    const tantosha = periodData.担当者別;
    container.innerHTML += `<div class="card" style="background:#e0f2fe"><div class="section-title">👥 担当者別集計（${tantosha.length}名）</div><div class="table-container"><table><thead><tr><th>担当者</th><th class="text-right">登録数</th><th class="text-right">FTD数</th><th class="text-right">信用枠</th><th class="text-right">GGR</th><th class="text-right">NGR</th></tr></thead><tbody>${tantosha.map(t => `<tr><td>${t.担当者}</td><td class="text-right">${formatNumber(t.登録数)}</td><td class="text-right">${formatNumber(t.FTD数)}</td><td class="text-right">${formatCurrency(t.信用枠)}</td><td class="text-right">${formatCurrency(t.GGR)}</td><td class="text-right ${t.NGR < 0 ? 'text-red' : 'text-green'}">${formatCurrency(t.NGR)}</td></tr>`).join('')}</tbody></table></div></div>`;
  }
}

// ========== チャート ==========
function renderChart() {
  const ctx = document.getElementById('main-chart').getContext('2d');
  const business = BUSINESSES[currentBusiness];
  const data = business?.data || {};
  const periods = sortPeriods(Object.keys(data)).reverse().slice(-12);
  
  if (chartInstance) chartInstance.destroy();
  if (periods.length === 0) { ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height); return; }
  
  const type = business.type;
  let datasets = [];
  
  if (type === 'samExcel') {
    datasets = [
      { label: 'GGR', data: periods.map(p => { const d = data[p]?.サマリー || data[p] || {}; return d['GGR(WIN/LOSE)'] || d['GGR'] || d['WIN/LOSE'] || 0; }), backgroundColor: 'rgba(59,130,246,0.7)' },
      { label: 'NGR', data: periods.map(p => (data[p]?.サマリー?.['NGR'] || data[p]?.['NGR'] || 0)), backgroundColor: 'rgba(16,185,129,0.7)' }
    ];
  } else if (type === 'sloten') {
    datasets = [
      { label: 'GGR', data: periods.map(p => (data[p]?.サマリー?.['GGR'] || data[p]?.['GGR'] || 0)), backgroundColor: 'rgba(59,130,246,0.7)' },
      { label: '入出金差分', data: periods.map(p => (data[p]?.サマリー?.['入出金差分'] || data[p]?.['入出金差分'] || 0)), backgroundColor: 'rgba(16,185,129,0.7)' }
    ];
  } else if (type === 'ads') {
    datasets = [
      { label: 'コスト(円)', data: periods.map(p => (data[p]?.サマリー?.['コスト(円)'] || (data[p]?.サマリー?.['コスト合計'] || 0) * 150)), backgroundColor: 'rgba(239,68,68,0.7)' },
      { label: '登録×10000', data: periods.map(p => ((data[p]?.サマリー?.['登録合計'] || data[p]?.サマリー?.['登録数'] || 0) * 10000)), backgroundColor: 'rgba(139,92,246,0.7)' },
      { label: '入金×50000', data: periods.map(p => ((data[p]?.サマリー?.['入金合計'] || data[p]?.サマリー?.['入金数'] || 0) * 50000)), backgroundColor: 'rgba(16,185,129,0.7)' }
    ];
  } else if (type === 'agent') {
    datasets = [
      { label: '収益', data: periods.map(p => (data[p]?.サマリー?.['収益合計'] || 0)), backgroundColor: 'rgba(16,185,129,0.7)' },
      { label: 'NGR', data: periods.map(p => (data[p]?.サマリー?.['NGR'] || 0)), backgroundColor: 'rgba(139,92,246,0.7)' }
    ];
  } else {
    datasets = [{ label: 'GGR', data: periods.map(p => (data[p]?.サマリー?.['総GGR'] || data[p]?.サマリー?.['GGR'] || 0)), backgroundColor: 'rgba(59,130,246,0.7)' }];
  }
  
  chartInstance = new Chart(ctx, {
    type: 'bar',
    data: { labels: periods, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { position: 'top' } },
      scales: { y: { beginAtZero: true, ticks: { callback: v => '¥' + (v / 1000000).toFixed(0) + 'M' } } }
    }
  });
}

// ========== リンク ==========
function renderLinks() {
  const section = document.getElementById('links-section');
  const grid = document.getElementById('links-grid');
  const title = document.getElementById('links-title');
  
  let links = [];
  if (currentBusiness === 'DSC') { links = DSC_LINKS; title.textContent = '🔗 LP・ツール一覧（' + links.length + '件）'; }
  else if (currentBusiness === 'スロ天') { links = SLOTEN_LINKS; title.textContent = '🔗 リンク一覧（' + links.length + '件）'; }
  
  if (links.length === 0) { section.classList.add('hidden'); return; }
  section.classList.remove('hidden');
  
  const grouped = {};
  links.forEach(link => { if (!grouped[link.category]) grouped[link.category] = []; grouped[link.category].push(link); });
  
  grid.innerHTML = Object.entries(grouped).map(([cat, items]) => 
    `<div class="link-category"><h4>${cat}（${items.length}件）</h4><div>${items.map(item => `<a href="${item.url}" target="_blank" class="link-item">${item.name}</a>`).join('')}</div></div>`
  ).join('');
}

// ========== テーブル ==========
function renderTable() {
  const business = BUSINESSES[currentBusiness];
  const periodData = business?.data?.[currentPeriod];
  const data = periodData?.サマリー || periodData || {};
  const header = document.getElementById('table-header');
  const body = document.getElementById('table-body');
  
  // 週別データ（エージェント）
  if (business?.type === 'agent' && periodData?.週別?.length > 0) {
    const weekly = periodData.週別;
    header.innerHTML = '<th>日付</th><th class="text-right">入金</th><th class="text-right">出金</th><th class="text-right">収益</th><th class="text-right">T/O</th><th class="text-right">ローリング</th><th class="text-right">大阪</th><th class="text-right">報酬計</th><th class="text-right">NGR</th>';
    body.innerHTML = weekly.map(w => `<tr><td>${w.日付}</td><td class="text-right">${formatCurrency(w.入金)}</td><td class="text-right">${formatCurrency(w.出金)}</td><td class="text-right ${w.収益 >= 0 ? 'text-green' : 'text-red'}">${formatCurrency(w.収益)}</td><td class="text-right">${formatCurrency(w['T/O'])}</td><td class="text-right">${formatCurrency(w.ローリング)}</td><td class="text-right">${formatCurrency(w.大阪)}</td><td class="text-right">${formatCurrency(w.ローリング報酬)}</td><td class="text-right ${w.NGR >= 0 ? 'text-green' : 'text-red'}">${formatCurrency(w.NGR)}</td></tr>`).join('');
    return;
  }
  
  // 日別データ（広告）
  if (business?.type === 'ads' && periodData?.日別?.length > 0) {
    const daily = periodData.日別;
    header.innerHTML = '<th>日付</th><th class="text-right">コスト</th><th class="text-right">IMP</th><th class="text-right">クリック</th><th class="text-right">登録</th><th class="text-right">入金</th>';
    body.innerHTML = daily.map(d => `<tr><td>${d.日付}</td><td class="text-right">$${(d.コスト||0).toFixed(2)}</td><td class="text-right">${formatNumber(d.インプレッション)}</td><td class="text-right">${formatNumber(d.クリック)}</td><td class="text-right text-green">${d.登録}</td><td class="text-right text-green">${d.入金}</td></tr>`).join('');
    return;
  }
  
  if (!data || Object.keys(data).length === 0) {
    header.innerHTML = '';
    body.innerHTML = '<tr><td colspan="2" style="text-align:center;padding:40px;color:#94a3b8">データがありません</td></tr>';
    return;
  }
  
  const percentKeys = ['FTP率','FTD率','FTW率','FTDW率','RTP','回収率(全体)','回収率(今月)','回収率','CTR','CVR','入金率'];
  const currencyKeys = ['T/O','勝利金','GGR','NGR','回収金額','出金金額','入金合計','出金合計','収益合計','コスト'];
  
  header.innerHTML = '<th>項目</th><th class="text-right">値</th>';
  body.innerHTML = Object.entries(data).filter(([k]) => !k.startsWith('_')).map(([key, value]) => {
    if (typeof value === 'object') return '';
    let formatted;
    if (typeof value === 'number') {
      if (percentKeys.some(pk => key.includes(pk))) formatted = formatPercent(value);
      else if (currencyKeys.some(ck => key.includes(ck))) formatted = formatCurrency(value);
      else if (key.includes('数') || key.includes('人数') || key.includes('件数')) formatted = formatNumber(value);
      else formatted = formatCurrency(value);
    } else {
      formatted = String(value);
    }
    const isNeg = typeof value === 'number' && value < 0;
    return `<tr><td>${key}</td><td class="text-right ${isNeg ? 'text-red' : ''}">${formatted}</td></tr>`;
  }).join('');
}

// ========== モーダル ==========
function showUploadModal() { document.getElementById('upload-modal').classList.remove('hidden'); document.getElementById('upload-status').style.display = 'none'; }
function hideUploadModal() { document.getElementById('upload-modal').classList.add('hidden'); }
function showAddBusinessModal() { document.getElementById('add-business-modal').classList.remove('hidden'); }
function hideAddBusinessModal() { document.getElementById('add-business-modal').classList.add('hidden'); }

function setupDragDrop() {
  const zone = document.getElementById('upload-zone');
  zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('dragover'); });
  zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
  zone.addEventListener('drop', e => { e.preventDefault(); zone.classList.remove('dragover'); if (e.dataTransfer.files[0]) handleFileUpload(e.dataTransfer.files[0]); });
}

function showStatus(msg, isError = false) {
  const s = document.getElementById('upload-status');
  s.style.display = 'block';
  s.style.background = isError ? '#fee2e2' : '#dcfce7';
  s.style.color = isError ? '#dc2626' : '#16a34a';
  s.textContent = msg;
}

// ========== ファイルアップロード ==========
function handleFileUpload(file) {
  if (!file) return;
  const period = document.getElementById('upload-period').value || new Date().toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' }).replace(' ', '');
  const uploadType = document.getElementById('upload-type').value;
  const reader = new FileReader();
  
  // ZIPファイルの場合はエラー
  if (file.name.endsWith('.zip')) {
    showStatus('ZIPファイルは対応していません。解凍してから個別のファイルをアップロードしてください。', true);
    return;
  }
  
  reader.onload = function(e) {
    try {
      if (file.name.endsWith('.csv')) {
        handleCSV(e.target.result, period, uploadType, file.name);
      } else {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        handleExcel(workbook, period, uploadType, file.name);
      }
    } catch (err) {
      showStatus('エラー: ' + err.message, true);
    }
  };
  
  if (file.name.endsWith('.csv')) reader.readAsText(file, 'UTF-8');
  else reader.readAsArrayBuffer(file);
}

// ========== CSV処理 ==========
function handleCSV(text, period, uploadType, filename) {
  const parseCSVLine = (line) => {
    const result = []; let current = ''; let inQuotes = false;
    for (let i = 0; i < line.length; i++) {
      const c = line[i];
      if (c === '"') inQuotes = !inQuotes;
      else if (c === ',' && !inQuotes) { result.push(current.trim().replace(/^"|"$/g, '')); current = ''; }
      else current += c;
    }
    result.push(current.trim().replace(/^"|"$/g, ''));
    return result;
  };
  
  const lines = text.replace(/\r\n/g, '\n').split('\n').filter(l => l.trim()).map(l => parseCSVLine(l));
  if (lines.length < 2) { showStatus('CSVにデータがありません', true); return; }
  
  const headerStr = lines[0].join(',').toLowerCase();
  const fn = filename.toLowerCase();
  
  // ファイル名またはヘッダーから自動判別
  const isCustomerList = fn.includes('顧客リスト') || fn.includes('customer');
  const isUncollected = fn.includes('未回収') || headerStr.includes('残未回収金額');
  const isDelayed = fn.includes('遅れ回収') || fn.includes('遅れ') || (headerStr.includes('本来支払日') && headerStr.includes('今回返済'));
  const isBonus = fn.includes('ボーナス') || fn.includes('キャッシュバック') || headerStr.includes('総ボーナス付与金額');
  const isAgent = fn.includes('エージェント') || fn.includes('agent') || (headerStr.includes('teamkyoto') || headerStr.includes('ローリング'));
  const isAds = fn.includes('日报') || fn.includes('広告') || (headerStr.includes('コスト') && headerStr.includes('インプレッション'));
  
  // 自動判別
  if (uploadType === 'auto') {
    if (isCustomerList) { parseCustomerListCSV(lines, period, fn); return; }
    if (isUncollected) { parseUncollectedCSV(lines, period, fn); return; }
    if (isDelayed) { parseDelayedCSV(lines, period, fn); return; }
    if (isBonus) { parseBonusCSV(lines, period, fn); return; }
    if (isAgent) { parseAgentCSV(lines, period); return; }
    if (isAds) { parseAdsCSV(lines, period); return; }
  }
  
  // 種別指定
  if (uploadType === 'customerList') { parseCustomerListCSV(lines, period, fn); return; }
  if (uploadType === 'uncollected') { parseUncollectedCSV(lines, period, fn); return; }
  if (uploadType === 'bonus') { parseBonusCSV(lines, period, fn); return; }
  if (uploadType === 'delayed') { parseDelayedCSV(lines, period, fn); return; }
  if (uploadType === 'agent') { parseAgentCSV(lines, period); return; }
  if (uploadType === 'ads') { parseAdsCSV(lines, period); return; }
  
  showStatus('CSVの形式を判別できませんでした', true);
}

function parseCustomerListCSV(lines, period, filename) {
  const fn = filename.toLowerCase();
  const isDSC = fn.includes('リストd') || fn.includes('d.csv') || filename.includes('リストD');
  const target = isDSC ? 'DSC' : '元amuse';
  
  // ヘッダー行（行3）を探す
  let headerRowIdx = -1;
  for (let i = 0; i < Math.min(10, lines.length); i++) {
    const row = lines[i];
    if (row && row.some(cell => String(cell).includes('FULLNAME1') || String(cell).includes('トータル回収額'))) {
      headerRowIdx = i;
      break;
    }
  }
  if (headerRowIdx < 0) headerRowIdx = 3; // デフォルト
  
  const header = lines[headerRowIdx] || [];
  
  // カラムインデックスを動的に取得
  const colIdx = {};
  header.forEach((h, idx) => {
    const col = String(h).trim();
    if (col === 'FULLNAME1') colIdx.name = idx;
    if (col === 'credit' || col === '信用枠') colIdx.credit = idx;
    if (col.includes('トータル回収額')) colIdx.collected = idx;
    if (col.includes('トータル出金額')) colIdx.withdraw = idx;
    if (col.includes('トータル差分利益')) colIdx.diff = idx;
    if (col.includes('トータルT/O') || col === 'T/O') colIdx.to = idx;
    if (col === '入金回数') colIdx.depCount = idx;
    if (col === '出金回数') colIdx.wdCount = idx;
    if (col === 'NGR' && !colIdx.ngr) colIdx.ngr = idx; // 最初のNGRのみ
    if (col === 'ボーナス付与総金額') colIdx.bonus = idx;
  });
  
  // 担当者集計のヘッダー位置を探す（行4の右側）
  let tantoshaStartCol = -1;
  if (lines[headerRowIdx + 1]) {
    const firstDataRow = lines[headerRowIdx + 1];
    for (let j = 40; j < firstDataRow.length; j++) {
      if (String(firstDataRow[j]).trim() === '担当者') {
        tantoshaStartCol = j;
        break;
      }
    }
  }
  
  let stats = { 
    総登録数: 0, 総回収額: 0, 総出金額: 0, 総差分利益: 0, 総NGR: 0, 
    FTD数: 0, FTW数: 0, FTDW数: 0, 総信用枠: 0, 総TO: 0, 総ボーナス: 0
  };
  
  // 担当者別データ
  const tantoshaData = [];
  
  // データ行を処理（ヘッダー行の次から）
  for (let i = headerRowIdx + 1; i < lines.length; i++) {
    const row = lines[i];
    if (!row || row.length < 10) continue;
    
    // 左側: 個別顧客データ（FULLNAME1がある行）
    const name = String(row[colIdx.name] || row[1] || '').trim();
    if (name && name !== '担当者' && !name.includes('セル')) {
      stats.総登録数++;
      
      const collected = parseNumber(row[colIdx.collected] || row[8]) || 0;
      const withdraw = parseNumber(row[colIdx.withdraw] || row[9]) || 0;
      const diff = parseNumber(row[colIdx.diff] || row[10]) || 0;
      const to = parseNumber(row[colIdx.to] || row[11]) || 0;
      const depCount = parseNumber(row[colIdx.depCount] || row[18]) || 0;
      const wdCount = parseNumber(row[colIdx.wdCount] || row[19]) || 0;
      const ngr = parseNumber(row[colIdx.ngr] || row[20]) || 0;
      const credit = parseNumber(row[colIdx.credit] || row[7]) || 0;
      const bonus = parseNumber(row[colIdx.bonus] || row[21]) || 0;
      
      stats.総回収額 += collected;
      stats.総出金額 += withdraw;
      stats.総差分利益 += diff;
      stats.総TO += to;
      stats.総NGR += ngr;
      stats.総信用枠 += credit;
      stats.総ボーナス += bonus;
      
      // FTD判定: 入金回数が1以上、または回収額が0より大きい場合
      const hasFTD = depCount > 0 || collected > 0;
      const hasWithdraw = wdCount > 0 || withdraw > 0;
      
      if (hasFTD) { 
        stats.FTD数++; 
        if (hasWithdraw) stats.FTDW数++; 
      }
      if (hasWithdraw) stats.FTW数++;
    }
    
    // 右側: 担当者別集計データ（tantoshaStartColが見つかった場合）
    if (tantoshaStartCol > 0 && row[tantoshaStartCol]) {
      const tName = String(row[tantoshaStartCol]).trim();
      if (tName && tName !== '担当者' && tName !== 'あり' && tName !== 'なし') {
        const tData = {
          担当者: tName,
          登録数: parseNumber(row[tantoshaStartCol + 1]) || 0,
          プレイ数: parseNumber(row[tantoshaStartCol + 2]) || 0,
          FTD数: parseNumber(row[tantoshaStartCol + 4]) || 0,
          信用枠: parseNumber(row[tantoshaStartCol + 6]) || 0,
          TO: parseNumber(row[tantoshaStartCol + 7]) || 0,
          GGR: parseNumber(row[tantoshaStartCol + 10]) || 0,
          NGR: parseNumber(row[tantoshaStartCol + 12]) || 0
        };
        if (tData.登録数 > 0 || tData.FTD数 > 0) {
          tantoshaData.push(tData);
        }
      }
    }
  }
  
  // FTD率を計算
  stats['FTD率'] = stats.総登録数 > 0 ? stats.FTD数 / stats.総登録数 : 0;
  stats['FTW率'] = stats.総登録数 > 0 ? stats.FTW数 / stats.総登録数 : 0;
  stats['FTDW率'] = stats.FTD数 > 0 ? stats.FTDW数 / stats.FTD数 : 0;
  stats['回収出金差分'] = stats.総回収額 - stats.総出金額;
  stats['平均信用枠'] = stats.総登録数 > 0 ? stats.総信用枠 / stats.総登録数 : 0;
  stats['平均NGR'] = stats.総登録数 > 0 ? stats.総NGR / stats.総登録数 : 0;
  
  // 担当者数
  if (tantoshaData.length > 0) {
    stats['担当者数'] = tantoshaData.length;
    // 担当者別の合計
    let tTotalReg = 0, tTotalFTD = 0, tTotalGGR = 0, tTotalNGR = 0;
    tantoshaData.forEach(t => {
      tTotalReg += t.登録数;
      tTotalFTD += t.FTD数;
      tTotalGGR += t.GGR;
      tTotalNGR += t.NGR;
    });
    stats['担当者計_登録数'] = tTotalReg;
    stats['担当者計_FTD数'] = tTotalFTD;
    stats['担当者計_GGR'] = tTotalGGR;
    stats['担当者計_NGR'] = tTotalNGR;
  }
  
  const existing = BUSINESSES[target].data[period]?.サマリー || {};
  BUSINESSES[target].data[period] = { 
    サマリー: { ...existing, ...stats },
    ...(tantoshaData.length > 0 ? { 担当者別: tantoshaData } : {})
  };
  
  const tantoshaInfo = tantoshaData.length > 0 ? `, 担当者${tantoshaData.length}名` : '';
  showStatus(`顧客リスト取込完了: ${target} ${stats.総登録数}件${tantoshaInfo}, FTD${stats.FTD数}件`);
  selectBusiness(target);
  setTimeout(hideUploadModal, 1500);
}

function parseUncollectedCSV(lines, period, filename) {
  // DSC判定: ファイル名末尾にD（大文字）がある、または「シートD」「D.csv」を含む
  const fn = filename.toLowerCase();
  const isDSC = fn.includes('シートd') || fn.includes('d.csv') || fn.endsWith('d') || filename.includes('シートD');
  const target = isDSC ? 'DSC' : '元amuse';
  
  let total = 0;
  let count = 0;
  
  // 最初の数行で「未回収金総額」を探す
  for (let i = 0; i < Math.min(5, lines.length); i++) {
    const row = lines[i];
    if (!row) continue;
    const rowStr = row.join(',');
    if (rowStr.includes('未回収金総額')) {
      // この行から金額を探す
      for (let j = 0; j < row.length; j++) {
        const val = parseNumber(row[j]);
        if (val && val > 1000000) { // 100万以上なら総額
          total = val;
          break;
        }
      }
      // 人数を探す
      for (let j = 0; j < row.length; j++) {
        const val = parseNumber(row[j]);
        if (val && val > 0 && val < 10000) { // 1万未満なら人数
          count = val;
          break;
        }
      }
      break;
    }
  }
  
  // 見つからなければ従来の方法
  if (total === 0) {
    const colIdx = lines[0].findIndex(h => String(h).includes('残未回収'));
    for (let i = 1; i < lines.length; i++) {
      const val = parseNumber(lines[i][colIdx >= 0 ? colIdx : 0]) || 0;
      total += val;
    }
    count = lines.length - 1;
  }
  
  const data = { '未回収者数': count, '残未回収金額': total };
  const existing = BUSINESSES[target].data[period]?.サマリー || {};
  BUSINESSES[target].data[period] = { サマリー: { ...existing, ...data } };
  
  showStatus(`未回収シート取込完了: ${target} ${count}人, ${formatCurrency(total)}`);
  selectBusiness(target);
  setTimeout(hideUploadModal, 1500);
}

function parseBonusCSV(lines, period, filename) {
  const fn = filename.toLowerCase();
  const isDSC = fn.includes('ボーナスd') || fn.includes('d.csv') || filename.includes('ボーナスD');
  const target = isDSC ? 'DSC' : '元amuse';
  
  let totalBonus = 0, totalDeposit = 0, totalNGR = 0;
  let count = 0;
  
  // TOTAL行を探す
  for (let i = 0; i < lines.length; i++) {
    const row = lines[i];
    if (!row) continue;
    const firstCol = String(row[0] || '').trim().toUpperCase();
    if (firstCol === 'TOTAL') {
      totalBonus = parseNumber(row[1]) || 0;
      break;
    }
  }
  
  // ヘッダー行を探してデータ行をカウント
  const header = lines[0] || [];
  const bonusIdx = header.findIndex(h => String(h).includes('総ボーナス付与金額'));
  const depIdx = header.findIndex(h => String(h).includes('トータル入金額'));
  const ngrIdx = header.findIndex(h => String(h).includes('実NGR'));
  
  // データ行をカウント（TOTAL行以降）
  let foundTotal = false;
  for (let i = 1; i < lines.length; i++) {
    const row = lines[i];
    if (!row) continue;
    const firstCol = String(row[0] || '').trim().toUpperCase();
    if (firstCol === 'TOTAL') { foundTotal = true; continue; }
    if (!foundTotal) continue;
    
    // 有効なデータ行（名前がある）
    if (row[3] && String(row[3]).trim()) {
      count++;
      if (depIdx >= 0) totalDeposit += parseNumber(row[depIdx]) || 0;
      if (ngrIdx >= 0) totalNGR += parseNumber(row[ngrIdx]) || 0;
    }
  }
  
  const data = { 'ボーナス対象者数': count, '総ボーナス付与金額': totalBonus, 'ボーナス対象入金額': totalDeposit, 'ボーナス対象NGR': totalNGR };
  const existing = BUSINESSES[target].data[period]?.サマリー || {};
  BUSINESSES[target].data[period] = { サマリー: { ...existing, ...data } };
  
  showStatus(`ボーナスシート取込完了: ${target} ${count}人, 総額${formatCurrency(totalBonus)}`);
  selectBusiness(target);
  setTimeout(hideUploadModal, 1500);
}

// 遅れ回収シートパーサー
function parseDelayedCSV(lines, period, filename) {
  const fn = filename.toLowerCase();
  const isDSC = fn.includes('回収d') || fn.includes('d.csv') || filename.includes('回収D');
  const target = isDSC ? 'DSC' : '元amuse';
  
  let totalDelayed = 0;
  let count = 0;
  
  // 「今回返済金額」列を探す
  const header = lines[0] || [];
  const amountIdx = header.findIndex(h => String(h).includes('今回返済金額'));
  
  // トータル行を探す
  for (let i = 0; i < Math.min(10, lines.length); i++) {
    const row = lines[i];
    if (!row) continue;
    const rowStr = row.join(',');
    if (rowStr.includes('トータル')) {
      // この行から担当者別の金額を探す
      for (let j = 0; j < row.length; j++) {
        const val = parseNumber(row[j]);
        if (val && val > 0) {
          // 担当者名の直後の金額を合計
        }
      }
    }
  }
  
  // データ行から集計
  for (let i = 1; i < lines.length; i++) {
    const row = lines[i];
    if (!row || row.length < 10) continue;
    
    const amount = parseNumber(row[amountIdx >= 0 ? amountIdx : 10]) || 0;
    if (amount > 0) {
      totalDelayed += amount;
      count++;
    }
  }
  
  const data = { '遅れ回収件数': count, '遅れ回収金額': totalDelayed };
  const existing = BUSINESSES[target].data[period]?.サマリー || {};
  BUSINESSES[target].data[period] = { サマリー: { ...existing, ...data } };
  
  showStatus(`遅れ回収シート取込完了: ${target} ${count}件, ${formatCurrency(totalDelayed)}`);
  selectBusiness(target);
  setTimeout(hideUploadModal, 1500);
}

function parseAgentCSV(lines, period) {
  let weeklyData = [];
  let totals = { 入金合計: 0, 出金合計: 0, 収益合計: 0, TO合計: 0, ローリング合計: 0, 大阪合計: 0 };
  
  for (let i = 2; i < lines.length; i++) {
    const row = lines[i];
    if (!row || row.length < 17) continue;
    
    const col7 = (row[7] || '').trim();
    const col12 = (row[12] || '').trim();
    const isOldFormat = col7.includes('/') && !col7.toLowerCase().includes('kyoto');
    const isNewFormat = col7 === '' && col12.includes('/');
    
    if (isOldFormat || isNewFormat) {
      const 日付 = isOldFormat ? col7 : col12;
      const 入金 = parseNumber(row[8]) || 0;
      const 出金 = parseNumber(row[9]) || 0;
      const 収益 = parseNumber(row[11]) || 0;
      const TO = parseNumber(row[13]) || 0;
      const ローリング = parseNumber(row[14]) || 0;
      const 大阪 = parseNumber(row[16]) || 0;
      const ローリング報酬 = ローリング + 大阪;
      const NGR = 収益 - ローリング報酬;
      
      totals.入金合計 += 入金;
      totals.出金合計 += 出金;
      totals.収益合計 += 収益;
      totals.TO合計 += TO;
      totals.ローリング合計 += ローリング;
      totals.大阪合計 += 大阪;
      
      weeklyData.push({ 日付, 入金, 出金, 収益, 'T/O': TO, ローリング, 大阪, ローリング報酬, NGR });
    }
  }
  
  const ローリング報酬合計 = totals.ローリング合計 + totals.大阪合計;
  const NGR合計 = totals.収益合計 - ローリング報酬合計;
  
  BUSINESSES['AMUSEVIP'].data['全期間'] = {
    サマリー: { ...totals, 'ローリング報酬': ローリング報酬合計, 'NGR': NGR合計, '精算回数': weeklyData.length },
    週別: weeklyData
  };
  
  showStatus(`エージェント取込完了: ${weeklyData.length}回, 収益${formatCurrency(totals.収益合計)}`);
  selectBusiness('AMUSEVIP');
  setTimeout(hideUploadModal, 1500);
}

function parseAdsCSV(lines, period) {
  const header = lines[0].map(h => String(h || '').toLowerCase().replace(/\n/g, ''));
  
  // インデックス検索（最初にマッチしたものだけ使用）
  const dateIdx = header.findIndex(h => h.includes('date') || h === '日付');
  const costIdx = header.findIndex(h => h.includes('コスト') || h === 'cost');
  const impIdx = header.findIndex(h => h.includes('インプレッション') || h.includes('imp'));
  const clickIdx = header.findIndex(h => h.includes('クリック') || h.includes('click'));
  // 登録数は「登録数」のみ（部分一致の誤検出を防止）
  const regIdx = header.findIndex(h => h === '登録数' || h === 'registrations');
  // 入金数は最初の「入金数」のみ（[BO: Asp]などの重複を除外）
  const depIdx = header.findIndex(h => h === '入金数' || h === 'deposits');
  
  let dailyData = [];
  let totals = { コスト: 0, インプレッション: 0, クリック: 0, 登録: 0, 入金: 0 };
  
  for (let i = 1; i < lines.length; i++) {
    const row = lines[i];
    if (!row || row.length < 5) continue;
    
    const parseVal = (idx, fallback) => {
      if (idx < 0 && fallback < 0) return 0;
      const v = row[idx >= 0 ? idx : fallback] || '';
      return parseFloat(String(v).replace(/[$￥¥,"\s]/g, '')) || 0;
    };
    
    const date = row[dateIdx >= 0 ? dateIdx : 0] || '';
    const cost = parseVal(costIdx, 1);
    const imp = parseVal(impIdx, 2);
    const click = parseVal(clickIdx, 3);
    const reg = parseVal(regIdx, 4);
    const dep = parseVal(depIdx, 5);
    
    totals.コスト += cost;
    totals.インプレッション += imp;
    totals.クリック += click;
    totals.登録 += reg;
    totals.入金 += dep;
    
    if (cost > 0 || reg > 0) dailyData.push({ 日付: date, コスト: cost, インプレッション: imp, クリック: click, 登録: reg, 入金: dep });
  }
  
  const ctr = totals.インプレッション > 0 ? totals.クリック / totals.インプレッション : 0;
  const cvr = totals.クリック > 0 ? totals.登録 / totals.クリック : 0;
  const costYen = totals.コスト < 10000 ? totals.コスト * 150 : totals.コスト;
  const cpaUsd = totals.登録 > 0 ? totals.コスト / totals.登録 : 0;
  const cpaYen = totals.登録 > 0 ? costYen / totals.登録 : 0;
  
  BUSINESSES['広告'].data['全期間'] = {
    サマリー: { 'コスト合計': totals.コスト, 'コスト(円)': costYen, 'インプレッション合計': totals.インプレッション, 'クリック合計': totals.クリック, '登録合計': totals.登録, '入金合計': totals.入金, 'CTR': ctr, 'CVR': cvr, 'CPA(登録)': cpaUsd, 'CPA(円)': cpaYen, 'データ日数': dailyData.length },
    日別: dailyData
  };
  
  showStatus(`広告データ取込完了: ${dailyData.length}日, $${totals.コスト.toFixed(2)}, 登録${totals.登録}件, 入金${totals.入金}件`);
  selectBusiness('広告');
  setTimeout(hideUploadModal, 1500);
}

// ========== Excel処理 ==========
function handleExcel(workbook, period, uploadType, filename) {
  const sheetNames = workbook.SheetNames;
  const fn = filename.toLowerCase();
  
  // スロ天KPIシート（YYYYMM形式のシート）
  const slotenSheets = sheetNames.filter(s => /^\d{6}$/.test(s));
  if (uploadType === 'sloten' || (uploadType === 'auto' && (slotenSheets.length > 0 || fn.includes('スロ天') || fn.includes('kpi')))) {
    parseSlotenExcel(workbook, slotenSheets);
    return;
  }
  
  // バカラツール（ダッシュボードまたはコストシートがある、またはファイル名にバカラ含む）
  const hasBaccaraSheet = sheetNames.includes('ダッシュボード') || sheetNames.includes('コスト') || sheetNames.some(s => s.includes('バカラ'));
  if (uploadType === 'baccarat' || (uploadType === 'auto' && (hasBaccaraSheet || fn.includes('バカラ') || fn.includes('baccara')))) {
    parseBaccaratExcel(workbook, period);
    return;
  }
  
  // 収益シート（元amuse/DSC）
  const revenueSheets = sheetNames.filter(s => s.includes('収益') && !s.includes('import'));
  if (revenueSheets.length > 0) {
    parseSamExcel(workbook, revenueSheets);
    return;
  }
  
  // デフォルト: 最初のシートを解析
  parseGenericExcel(workbook, period);
}

function parseSlotenExcel(workbook, monthlySheets) {
  let count = 0;
  
  monthlySheets.forEach(sheetName => {
    const sheet = workbook.Sheets[sheetName];
    const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
    
    const kpi = {};
    const depositMethods = {};
    const withdrawMethods = {};
    const gameData = {};
    const affData = {};
    
    // サマリーKPI
    data.forEach((row, idx) => {
      if (!row || row.length < 2) return;
      const label = String(row[0] || '').trim().split('/')[0].trim();
      const val = parseNumber(row[1]);
      if (label && val !== null && label !== '項目名') kpi[label] = val;
    });
    
    // 入金方法（行191-197付近）
    for (let i = 191; i < Math.min(198, data.length); i++) {
      const row = data[i];
      if (row && row[0] && row[1] !== undefined) {
        const key = String(row[0]).trim();
        if (key && key !== '入金') {
          const val = parseNumber(row[1]);
          if (val !== null) depositMethods[key] = val;
        }
      }
    }
    
    // 出金方法（行199-204付近）
    for (let i = 199; i < Math.min(205, data.length); i++) {
      const row = data[i];
      if (row && row[0] && row[1] !== undefined) {
        const key = String(row[0]).trim();
        if (key && key !== '出金') {
          const val = parseNumber(row[1]);
          if (val !== null) withdrawMethods[key] = val;
        }
      }
    }
    
    // ゲーム別データ
    const gamePositions = [
      { name: 'パチンコ', userRow: 123, toRow: 124, ggrRow: 127 },
      { name: 'パチスロ', userRow: 142, toRow: 143, ggrRow: 146 },
      { name: 'スロット', userRow: 161, toRow: 162, ggrRow: 165 },
      { name: 'ライブ', userRow: 180, toRow: 181, ggrRow: 184 }
    ];
    gamePositions.forEach(g => {
      if (data[g.userRow] && data[g.toRow] && data[g.ggrRow]) {
        gameData[g.name] = {
          ユーザー数: parseNumber(data[g.userRow]?.[1]) || 0,
          TO: parseNumber(data[g.toRow]?.[1]) || 0,
          GGR: parseNumber(data[g.ggrRow]?.[1]) || 0
        };
      }
    });
    
    // Affiliate（行92-111付近）
    for (let i = 92; i < Math.min(112, data.length); i++) {
      const row = data[i];
      if (row && row[0] && row[1] !== undefined) {
        const key = String(row[0]).trim().split('/')[0].trim();
        if (key && key.includes('AFF')) {
          const val = parseNumber(row[1]);
          if (val !== null) affData[key] = val;
        }
      }
    }
    
    const year = sheetName.substring(0, 4);
    const month = parseInt(sheetName.substring(4, 6));
    const periodName = `${year}年${month}月`;
    
    if (Object.keys(kpi).length > 0) {
      BUSINESSES['スロ天'].data[periodName] = {
        サマリー: kpi,
        ...(Object.keys(depositMethods).length > 0 ? { 入金方法: depositMethods } : {}),
        ...(Object.keys(withdrawMethods).length > 0 ? { 出金方法: withdrawMethods } : {}),
        ...(Object.keys(gameData).length > 0 ? { ゲーム別: gameData } : {}),
        ...(Object.keys(affData).length > 0 ? { Affiliate: affData } : {})
      };
      count++;
    }
  });
  
  showStatus(`スロ天データ取込完了: ${count}期間`);
  selectBusiness('スロ天');
  setTimeout(hideUploadModal, 1500);
}

function parseBaccaratExcel(workbook, period) {
  // 各シートを探す
  const dashSheetName = workbook.SheetNames.find(s => s.includes('ダッシュボード') || s.includes('Dashboard') || s.includes('サマリー'));
  const dashSheet = dashSheetName ? workbook.Sheets[dashSheetName] : workbook.Sheets[workbook.SheetNames[0]];
  const costSheet = workbook.Sheets['コスト'] || workbook.Sheets['cost'] || workbook.Sheets['Cost'];
  const userSheet = workbook.Sheets['ユーザー・収益分析'] || workbook.Sheets['ユーザー分析'];
  
  const extractedData = { 'LINE流入': 0, 'Telegram流入': 0, 'Twitter流入': 0, '合計流入': 0, '総ユーザー数': 0, '総入金額': 0, '総GGR': 0, 'コスト': 0, 'NGR': 0, '登録数': 0 };
  
  // ダッシュボードシートからデータ取得
  if (dashSheet) {
    const dashData = XLSX.utils.sheet_to_json(dashSheet, { header: 1 });
    dashData.forEach(row => {
      if (!row || row.length < 2) return;
      const label = String(row[0] || '').trim().toLowerCase();
      const value = parseNumber(row[1]);
      if (value === null) return;
      
      if (label.includes('line') && label.includes('流入')) extractedData['LINE流入'] = value;
      else if (label.includes('telegram') && label.includes('流入')) extractedData['Telegram流入'] = value;
      else if ((label.includes('twitter') || label.includes('x')) && label.includes('流入')) extractedData['Twitter流入'] = value;
      else if (label.includes('合計') && label.includes('流入')) extractedData['合計流入'] = value;
      else if (label.includes('総ユーザー') || label.includes('ユーザー数')) extractedData['総ユーザー数'] = value;
      else if (label.includes('総入金') || (label.includes('入金') && label.includes('額'))) extractedData['総入金額'] = value;
      else if (label.includes('ggr') && !label.includes('ngr')) extractedData['総GGR'] = value;
      else if (label === 'コスト' || label === 'cost') extractedData['コスト'] = value;
      else if (label === 'ngr') extractedData['NGR'] = value;
    });
  }
  
  // ユーザー・収益分析シートから登録数を合計
  if (userSheet) {
    const userData = XLSX.utils.sheet_to_json(userSheet, { header: 1 });
    let totalReg = 0;
    let regColIdx = -1;
    
    userData.forEach((row, idx) => {
      if (!row) return;
      // ヘッダー行で「登録」列を探す
      if (regColIdx < 0) {
        const foundIdx = row.findIndex(cell => String(cell || '').trim() === '登録');
        if (foundIdx >= 0) regColIdx = foundIdx;
      }
      // 「合計」行から登録数を取得
      const firstCell = String(row[0] || '').trim();
      if (firstCell === '合計' && regColIdx >= 0) {
        const regVal = parseNumber(row[regColIdx]);
        if (regVal !== null && regVal > 0) totalReg += regVal;
      }
    });
    
    if (totalReg > 0) extractedData['登録数'] = totalReg;
  }
  
  // コストシートから合計取得
  if (costSheet) {
    const costData = XLSX.utils.sheet_to_json(costSheet, { header: 1 });
    costData.forEach(row => {
      if (!row) return;
      const label = String(row[0] || '').trim().toLowerCase();
      if (label === '合計' || label === 'total') {
        const costVal = parseNumber(row[2]) || parseNumber(row[1]) || 0;
        if (costVal > 0) extractedData['コスト'] = costVal;
      }
    });
  }
  
  // NGR計算（なければ算出）
  if (extractedData['NGR'] === 0 && (extractedData['総GGR'] > 0 || extractedData['コスト'] > 0)) {
    extractedData['NGR'] = (extractedData['総GGR'] || 0) - (extractedData['コスト'] || 0);
  }
  
  // 合計流入がなければ計算
  if (extractedData['合計流入'] === 0) {
    extractedData['合計流入'] = extractedData['LINE流入'] + extractedData['Telegram流入'] + extractedData['Twitter流入'];
  }
  
  BUSINESSES['バカラツール'].data['全期間'] = { サマリー: extractedData };
  
  showStatus(`バカラツール取込完了: 登録${extractedData['登録数']}件, コスト${formatCurrency(extractedData['コスト'])}`);
  selectBusiness('バカラツール');
  setTimeout(hideUploadModal, 1500);
}

function parseSamExcel(workbook, revenueSheets) {
  let amuseCount = 0, dscCount = 0;
  
  revenueSheets.forEach(sheetName => {
    const sheet = workbook.Sheets[sheetName];
    const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
    
    // 分類: Dで終わる → DSC
    const isDSC = sheetName.endsWith('D');
    let periodName = sheetName.replace('収益', '').replace(/D$/, '');
    
    const extracted = {};
    data.forEach(row => {
      // B列(1)とC列(2)
      if (row[1] && row[2] !== undefined && row[2] !== null && row[2] !== '') {
        const key = String(row[1]).trim().replace(/（/g, '(').replace(/）/g, ')');
        const val = parseNumber(row[2]);
        if (val !== null && !String(row[2]).startsWith('#') && !key.startsWith('0.')) extracted[key] = val;
      }
      // D列(3)とE列(4)
      if (row[3] && row[4] !== undefined && row[4] !== null && row[4] !== '') {
        const key = String(row[3]).trim().replace(/（/g, '(').replace(/）/g, ')');
        const val = parseNumber(row[4]);
        if (val !== null && !String(row[4]).startsWith('#') && !key.startsWith('0.')) extracted[key] = val;
      }
    });
    
    if (Object.keys(extracted).length > 0) {
      if (isDSC) {
        BUSINESSES['DSC'].data[periodName] = { サマリー: extracted };
        dscCount++;
      } else {
        BUSINESSES['元amuse'].data[periodName] = { サマリー: extracted };
        amuseCount++;
      }
    }
  });
  
  showStatus(`収益シート取込完了: 元amuse ${amuseCount}件, DSC ${dscCount}件`);
  if (dscCount > 0) selectBusiness('DSC');
  else selectBusiness('元amuse');
  setTimeout(hideUploadModal, 1500);
}

function parseGenericExcel(workbook, period) {
  const sheet = workbook.Sheets[workbook.SheetNames[0]];
  const data = XLSX.utils.sheet_to_json(sheet, { header: 1 });
  
  const kpi = {};
  data.forEach(row => {
    if (!row || row.length < 2) return;
    const label = String(row[0] || '').trim();
    const val = parseNumber(row[1]);
    if (label && val !== null) kpi[label] = val;
  });
  
  BUSINESSES[currentBusiness].data[period] = { サマリー: kpi };
  showStatus(`Excel取込完了: ${Object.keys(kpi).length}項目`);
  selectBusiness(currentBusiness);
  setTimeout(hideUploadModal, 1500);
}

// ========== 事業追加・削除 ==========
function addBusiness() {
  const name = document.getElementById('new-business-name').value.trim();
  const type = document.getElementById('new-business-type').value;
  if (!name) { alert('事業名を入力してください'); return; }
  if (BUSINESSES[name]) { alert('同名の事業が存在します'); return; }
  BUSINESSES[name] = { data: {}, type: type };
  hideAddBusinessModal();
  selectBusiness(name);
}

function deleteBusiness() {
  if (Object.keys(BUSINESSES).length <= 1) { alert('最後の事業は削除できません'); return; }
  if (confirm(`「${currentBusiness}」を削除しますか？`)) {
    delete BUSINESSES[currentBusiness];
    selectBusiness(Object.keys(BUSINESSES)[0]);
  }
}
</script>
</body>
</html>